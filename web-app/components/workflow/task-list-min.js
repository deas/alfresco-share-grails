(function(){var e=YAHOO.util.Dom,g=YAHOO.util.Event;var c=Alfresco.util.encodeHTML,d=Alfresco.util.siteURL;Alfresco.component.TaskList=function(j){Alfresco.component.TaskList.superclass.constructor.call(this,"Alfresco.component.TaskList",j,["button","menu","container","datasource","datatable","paginator","json","history"]);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);return this};YAHOO.extend(Alfresco.component.TaskList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.component.TaskList,Alfresco.action.WorkflowActions);YAHOO.lang.augmentObject(Alfresco.component.TaskList.prototype,{options:{hiddenTaskTypes:[],filterParameters:[],maxItems:50},onReady:function b(){var j=Alfresco.constants.PROXY_URI+"api/task-instances?authority="+encodeURIComponent(Alfresco.constants.USERNAME)+"&properties="+["bpm_priority","bpm_status","bpm_dueDate","bpm_description"].join(",")+"&exclude="+this.options.hiddenTaskTypes.join(",");this.widgets.pagingDataTable=new Alfresco.util.DataTable({dataTable:{container:this.id+"-tasks",columnDefinitions:[{key:"id",sortable:false,formatter:this.bind(this.renderCellIcons),width:40},{key:"title",sortable:false,formatter:this.bind(this.renderCellTaskInfo)},{key:"name",sortable:false,formatter:this.bind(this.renderCellActions),width:200}],config:{MSG_EMPTY:this.msg("message.noTasks")}},dataSource:{url:j,defaultFilter:{filterId:"all"},filterResolver:this.bind(function(k){return this.createFilterURLParameters(k,this.options.filterParameters)})},paginator:{config:{containers:[this.id+"-paginator"],rowsPerPage:this.options.maxItems}}})},onFilterChanged:function i(k,j){var l=Alfresco.util.cleanBubblingObject(j[1]);e.get(this.id+"-filterTitle").innerHTML=c(this.msg("filter."+l.filterId+(l.filterData?"."+l.filterData:""),l.filterData))},renderCellIcons:function a(q,r,n,j){var p=r.getData("properties")["bpm_priority"],o={"1":"high","2":"medium","3":"low"},k=o[p+""],l=r.getData("isPooled");var m='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/priority-"+k+'-16.png" title="'+this.msg("label.priority",this.msg("priority."+k))+'"/>';if(l){m+='<br/><img src="'+Alfresco.constants.URL_RESCONTEXT+'components/images/pooled-task-16.png" title="'+this.msg("label.pooledTask")+'"/>'}q.innerHTML=m},renderCellTaskInfo:function f(s,u,p,j){var q=u.getData("id"),v=c(u.getData("properties")["bpm_description"]),n=u.getData("properties")["bpm_dueDate"],t=n?Alfresco.util.fromISO8601(n):null,r=c(u.getData("title")),l=c(u.getData("properties")["bpm_status"]),o=u.getData("owner");var m=u.getData();if(m.propertyLabels&&Alfresco.util.isValueSet(m.propertyLabels.bpm_status,false)){l=m.propertyLabels.bpm_status}if(v==r){v=this.msg("workflow.no_message")}var k='<h3><a href="'+d("task-edit?taskId="+q+"&referrer=tasks&myTasksLinkBack=true")+'" class="theme-color-1" title="'+this.msg("link.editTask")+'">'+v+"</a></h3>";k+='<div class="due"><label>'+this.msg("label.due")+":</label><span>"+(t?Alfresco.util.formatDate(t,"longDate"):this.msg("label.none"))+"</span></div>";k+='<div class="status"><label>'+this.msg("label.status")+":</label><span>"+l+"</span></div>";k+='<div class="type"><label>'+this.msg("label.type",r)+":</label><span>"+r+"</span></div>";if(!o||!o.userName){k+='<div class="unassigned"><span class="theme-bg-color-5 theme-color-5 unassigned-task">'+this.msg("label.unassignedTask")+"</span></div>"}s.innerHTML=k},renderCellActions:function h(k,j,l,m){this.createAction(k,this.msg("link.editTask"),"task-edit-link",d("task-edit?taskId="+j.getData("id")+"&referrer=tasks&myTasksLinkBack=true"));this.createAction(k,this.msg("link.viewTask"),"task-view-link",d("task-details?taskId="+j.getData("id")+"&referrer=tasks&myTasksLinkBack=true"));this.createAction(k,this.msg("link.viewWorkflow"),"workflow-view-link",d("workflow-details?workflowId="+j.getData("workflowInstance").id+"&taskId="+j.getData("id")+"&referrer=tasks&myTasksLinkBack=true"))}},true)})();