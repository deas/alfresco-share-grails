Alfresco.Share=Alfresco.Share||{};Alfresco.Share.postActivity=function(g,a,h,d,c){if(!YAHOO.lang.isString(g)||g.length===0||!YAHOO.lang.isString(a)||a.length===0||!YAHOO.lang.isString(h)||h.length===0||!YAHOO.lang.isObject(c)===null||!(YAHOO.lang.isString(c.nodeRef)||YAHOO.lang.isString(c.parentNodeRef))){return}var b={method:"POST",url:Alfresco.constants.PROXY_URI+"slingshot/activity/create",dataObj:YAHOO.lang.merge({site:g,type:a,title:h,page:d},c)};Alfresco.logger.debug("Alfresco.Share.postActivity: ",b.dataObj);try{Alfresco.util.Ajax.jsonRequest(b)}catch(f){}};(function(){var e=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML,f=Alfresco.util.combinePaths;Alfresco.Location=function h(i){if(YAHOO.lang.isString(i)){i=e.get(i)}else{if(!i.getAttribute("id")){Alfresco.util.generateDomId(i)}}Alfresco.Location.superclass.constructor.call(this,"Alfresco.Location",i.getAttribute("id"),["json"]);this.widgets.spanEl=i;return this};YAHOO.extend(Alfresco.Location,Alfresco.component.Base,{options:{rootNode:null,siteId:""},_locations:null,onReady:function g(){},displayByNodeRef:function d(j){if(YAHOO.lang.isString(j)){j=Alfresco.util.NodeRef(j)}if(j){var i=Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+j.uri+"/location";if(this.options.siteId===""&&this.options.rootNode){i+="?libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}Alfresco.util.Ajax.jsonGet({url:i,successCallback:{fn:function(l){if(l.json!==undefined){var k=l.json;this._locations=k;if(k.site){this.displayByPath(f(k.site.path,k.site.file),k.site.site,k.site.siteTitle)}else{this.displayByPath(f(k.repo.path,k.repo.file))}YAHOO.Bubbling.fire("itemLocationLoaded",{eventGroup:this,locations:k})}},scope:this},failureCallback:{fn:function(k){if(this.widgets.spanEl){this.widgets.spanEl.innerHTML='<span class="location error">'+this.msg("message.failure")+"</span>"}},scope:this}})}else{this.widgets.spanEl.innerHTML='<span class="location-none">'+this.msg("location.label.none")+"</span>"}},displayByPath:function c(i,k,j){this._locations=null;if(this.widgets.spanEl){this.widgets.spanEl.innerHTML=this.generateHTML(i,k,j)}},generateHTML:function b(k,p,m){var l=k.lastIndexOf("/"),o=l>=0?k.substring(0,l+1):"",j=l>=0?k.substring(l+1):k;if(p){if(Alfresco.util.arrayContains(["/",""],j+o)){k=this.msg("location.path.documents");j=this.msg("location.path.documents")}else{k=this.msg("location.path.documents")+k;j=".../"+j}}else{if(Alfresco.util.arrayContains(["/",""],j+o)){k=this.msg("location.path.repository");j=this.msg("location.path.repository")}else{k=this.msg("location.path.repository")+k;j=".../"+j}}var n='<span class="location-path" title="'+this.msg("location.tooltip.path",k)+'">'+a(j)+"</span>";if(p){if(p&&p!=this.options.siteId){var q='<span class="location-site" title="'+this.msg("location.tooltip.site",m?m:p)+'">'+a(m?m:p)+"</span>";return this.msg("location.label.site",n,q)}else{return this.msg("location.label.local",n)}}else{return this.msg("location.label.repository",n)}}})})();(function(){var e=YAHOO.util.Dom,b=YAHOO.util.Selector;var a=Alfresco.util.encodeHTML,g=Alfresco.util.combinePaths;Alfresco.Like=function h(i){if(YAHOO.lang.isString(i)){i=e.get(i)}else{if(!i.getAttribute("id")){Alfresco.util.generateDomId(i)}}YAHOO.util.Dom.addClass(i,"item-social");Alfresco.Like.superclass.constructor.call(this,"Alfresco.Like",i.getAttribute("id"),["json"]);this.widgets.spanEl=i;this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);return this};YAHOO.extend(Alfresco.Like,Alfresco.component.Base,{options:{nodeRef:null,siteId:null,displayName:null,type:"document",activity:{folder:{type:"org.alfresco.documentlibrary.folder-liked",page:"folder-details?nodeRef={nodeRef}"},document:{type:"org.alfresco.documentlibrary.file-liked",page:"document-details?nodeRef={nodeRef}"}}},isLiked:false,totalLikes:0,loadAndDisplay:function c(){throw new Error("Not implemented yet, load data manually and use display(isLiked, totalLikes) instead.")},display:function d(j,i){this.isLiked=j||false;this.totalLikes=i||0;this.render()},render:function f(){var i="";if(this.isLiked){i='<a href="#" class="like-action theme-color-1 enabled '+(this.isLiked?"like-action-liked":"")+'" title="'+this.msg("like."+this.options.type+".remove.tip")+'"></a>'}else{i='<a href="#" class="like-action theme-color-1" title="'+this.msg("like."+this.options.type+".add.tip")+'">'+this.msg("like."+this.options.type+".add.label")+"</a>"}i+='<span class="likes-count">'+a(this.totalLikes)+"</span>";this.widgets.spanEl.innerHTML=i;Alfresco.util.useAsButton(b.query("a",this.widgets.spanEl,true),function(k){var j=e.hasClass(b.query("a",this.widgets.spanEl,true),"like-action-liked");this.like(!j);YAHOO.util.Event.preventDefault(k)},null,this)},like:function(m){var l={isLiked:this.isLiked,totalLikes:this.totalLikes};this.isLiked=m=="true"||(YAHOO.lang.isBoolean(m)&&m);this.totalLikes=this.totalLikes+(this.isLiked?1:-1);var j={successCallback:{fn:function i(n){var p=n.json.data;if(p){this.totalLikes=p.ratingsCount;if(this.isLiked){var q=this.options.activity[this.options.type];if(q){var o=YAHOO.lang.substitute(q.page,{nodeRef:this.options.nodeRef});Alfresco.Share.postActivity(this.options.siteId,q.type,this.options.displayName,o,{nodeRef:this.options.nodeRef,fileName:this.options.displayName})}}}},scope:this},failureCallback:{fn:function k(n){this.isLiked=l.isLiked;this.totalLikes=l.totalLikes;this.render();Alfresco.util.PopupManager.displayPrompt({text:this.msg("like.message.failure")})},scope:this}};if(this.isLiked){this.services.likes.set(new Alfresco.util.NodeRef(this.options.nodeRef),1,j)}else{this.services.likes.remove(new Alfresco.util.NodeRef(this.options.nodeRef),j)}this.render()}})})();(function(){var e=YAHOO.util.Dom,c=YAHOO.util.Selector;var b=Alfresco.util.encodeHTML,g=Alfresco.util.combinePaths;Alfresco.Favourite=function h(i){if(YAHOO.lang.isString(i)){i=e.get(i)}else{if(!i.getAttribute("id")){Alfresco.util.generateDomId(i)}}YAHOO.util.Dom.addClass(i,"item-social");Alfresco.Favourite.superclass.constructor.call(this,"Alfresco.Favourite",i.getAttribute("id"),["json"]);this.widgets.spanEl=i;this.services.preferences=new Alfresco.service.Preferences();return this};YAHOO.extend(Alfresco.Favourite,Alfresco.component.Base,{options:{nodeRef:null,type:"document",preference:{folder:{key:Alfresco.service.Preferences.FAVOURITE_FOLDERS},document:{key:Alfresco.service.Preferences.FAVOURITE_DOCUMENTS}}},isFavourite:false,loadAndDisplay:function d(){throw new Error("Not implemented yet, load data manually and use display(isFavourite) instead.")},display:function f(i){this.isFavourite=i||false;this.render()},render:function a(){var i="";if(this.isFavourite){i='<a href="#" class="favourite-action theme-color-1 favourite-'+this.options.type+' enabled favourite-action-favourite" title="'+this.msg("favourite."+this.options.type+".remove.tip")+'"></a>'}else{i='<a href="#" class="favourite-action theme-color-1 favourite-'+this.options.type+'" title="'+this.msg("favourite."+this.options.type+".add.tip")+'">'+this.msg("favourite."+this.options.type+".add.label")+"</a>"}this.widgets.spanEl.innerHTML=i;Alfresco.util.useAsButton(c.query("a",this.widgets.spanEl,true),function(k){var j=e.hasClass(c.query("a",this.widgets.spanEl,true),"favourite-action-favourite");this.favourite(!j);YAHOO.util.Event.preventDefault(k)},null,this)},favourite:function(k){var m={isFavourite:this.isFavourite};this.isFavourite=k=="true"||(YAHOO.lang.isBoolean(k)&&k);var i={failureCallback:{fn:function n(o){this.isFavourite=m.isFavourite;this.render();Alfresco.util.PopupManager.displayPrompt({text:this.msg("favourite.message.failure")})},scope:this}};var j=this.options.preference[this.options.type];if(j){var l=this.isFavourite?"add":"remove";this.services.preferences[l].call(this.services.preferences,j.key,this.options.nodeRef,i)}else{throw new Error("No prefence has been given for type '"+this-options.type+"'.")}this.render()}})})();(function(){var c=YAHOO.util.Dom;Alfresco.widget.Resizer=function f(h){Alfresco.util.YUILoaderHelper.require(["resize"],this.onComponentsLoaded,this);this.name=h;this.widgets={};return this};Alfresco.widget.Resizer.prototype={MIN_FILTER_PANEL_HEIGHT:200,MIN_FILTER_PANEL_WIDTH:140,DEFAULT_FILTER_PANEL_WIDTH:160,MAX_FILTER_PANEL_WIDTH:500,widgets:null,options:{divLeft:"alf-filters",divRight:"alf-content",documentHeight:-1,initialWidth:null},onComponentsLoaded:function e(){YAHOO.util.Event.onDOMReady(this.onReady,this,true)},onReady:function a(){this.widgets.horizResize=new YAHOO.util.Resize(this.options.divLeft,{handles:["r"],minWidth:this.MIN_FILTER_PANEL_WIDTH,maxWidth:this.MAX_FILTER_PANEL_WIDTH});this.widgets.horizResize.on("beforeResize",function(i){this.onResize(i.width)},this,true);this.widgets.horizResize.on("endResize",function(i){this.onResize(i.width)},this,true);YAHOO.util.Event.on(window,"resize",function(i){this.onResize()},this,true);this.options.documentHeight=c.getXY("alf-ft")[1];YAHOO.lang.later(1000,this,function(){var i=c.getXY("alf-ft")[1];if(Math.abs(this.options.documentHeight-i)>4){this.options.documentHeight=i;this.onResize()}},null,true);var h=(this.options.initialWidth?this.options.initialWidth:this.DEFAULT_FILTER_PANEL_WIDTH);if(YAHOO.env.ua.ie>0){this.widgets.horizResize.resize(null,this.widgets.horizResize.get("element").offsetHeight,h,0,0,true)}else{this.widgets.horizResize.resize(null,this.widgets.horizResize.get("height"),h,0,0,true)}this.onResize(h)},onResize:function g(m){var q=c.get(this.options.divLeft).childNodes,n=q[q.length-1];c.setStyle(this.options.divLeft,"height","auto");c.setStyle(n,"height","");var l=c.getXY("alf-ft")[1]-c.getXY("alf-hd")[1]-c.get("alf-hd").offsetHeight;if(YAHOO.env.ua.ie===6){var p=c.get("alf-hd"),o=0;for(var k=0,j=p.childNodes.length;k<j;k++){o+=p.childNodes[k].offsetHeight}l=c.get("alf-ft").parentNode.offsetTop-o}if(l<this.MIN_FILTER_PANEL_HEIGHT){l=this.MIN_FILTER_PANEL_HEIGHT}c.setStyle(n,"height",l+"px");if(m!==undefined){c.setStyle(this.options.divRight,"margin-left",8+m+"px")}this.onResizeNotification()},onResizeNotification:function b(){},setOptions:function d(h){this.options=YAHOO.lang.merge(this.options,h);return this}}})();var DASHLET_TITLE_BAR_ACTIONS_OPACITY=0,OPACITY_FADE_SPEED=0.2;(function(){var d=YAHOO.util.Dom,b=YAHOO.util.Event,a=YAHOO.util.Selector;Alfresco.widget.DashletTitleBarActions=function g(h){return Alfresco.widget.DashletTitleBarActions.superclass.constructor.call(this,"Alfresco.widget.DashletTitleBarActions",h,["selector"])};YAHOO.extend(Alfresco.widget.DashletTitleBarActions,Alfresco.component.Base,{dashlet:null,dashletTitle:null,dashletBody:null,actionsNode:null,onReady:function f(){this.dashlet=a.query("div.dashlet",d.get(this.id),true);this.dashletTitle=a.query("div.title",this.dashlet,true);this.dashletBody=a.query("div.body",this.dashlet,true);if(this.dashlet&&this.dashletTitle&&this.dashletBody){this.actionsNode=document.createElement("div");d.addClass(this.actionsNode,"titleBarActions");if(YAHOO.env.ua.ie>0){}else{d.setStyle(this.actionsNode,"opacity",DASHLET_TITLE_BAR_ACTIONS_OPACITY)}this.dashlet.insertBefore(this.actionsNode,this.dashletBody);this.options.actions.reverse();for(var j=0;j<this.options.actions.length;j++){var h=this.options.actions[j];if(h.cssClass&&(h.eventOnClick||h.linkOnClick||h.targetOnClick||h.bubbleOnClick)){var k=document.createElement("div");if(h.tooltip){d.setAttribute(k,"title",h.tooltip)}d.addClass(k,"titleBarActionIcon");d.addClass(k,h.cssClass);this.actionsNode.appendChild(k);if(h.id){k.id=this.id+h.id}var m=this;if(h.eventOnClick){b.addListener(k,"click",(function(n){var i=h.eventOnClick;return function(o){m._fadeOut(o,m);i.fire({})}})())}else{if(h.linkOnClick){b.addListener(k,"click",(function(){var i=h.linkOnClick;return function(){window.location=i}})())}else{if(h.targetOnClick){b.addListener(k,"click",(function(){var i=h.targetOnClick;return function(){window.open(i)}})())}else{if(h.bubbleOnClick){var l=Alfresco.util.createBalloon(this.id,{html:h.bubbleOnClick.message,width:"30em"});b.addListener(k,"click",l.show,l,true)}}}}}else{Alfresco.logger.warn("DashletTitleBarActions_onReady: Action is not valid.")}}b.addListener(this.dashlet,"mouseover",this._fadeIn,this);b.addListener(this.dashlet,"mouseout",this._fadeOut,this)}else{}},_fadeOut:function c(i,h){if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9){h.actionsNode.style.display="none"}else{if(!d.isAncestor(h.dashlet,b.getRelatedTarget(i))){var j=new YAHOO.util.Anim(h.actionsNode,{opacity:{to:DASHLET_TITLE_BAR_ACTIONS_OPACITY}},OPACITY_FADE_SPEED);j.animate()}}},_fadeIn:function e(i,h){if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9){h.actionsNode.style.display="block"}else{var j=new YAHOO.util.Anim(h.actionsNode,{opacity:{to:1}},OPACITY_FADE_SPEED);j.animate()}}})})();(function(){var c=YAHOO.util.Dom,h=YAHOO.util.Event,a=YAHOO.util.Selector;Alfresco.widget.DashletResizer=function i(k,j){this.name="Alfresco.widget.DashletResizer";this.id=k;this.dashletId=j;Alfresco.util.YUILoaderHelper.require(["resize","selector"],this.onComponentsLoaded,this);this.widgets={};return this};Alfresco.widget.DashletResizer.prototype={options:{dashletHeight:-1,minDashletHeight:80,maxDashletHeight:1200},dashletId:"",widgets:null,dashlet:null,dashletBody:null,heightDelta:0,setOptions:function f(j){this.options=YAHOO.lang.merge(this.options,j);return this},onComponentsLoaded:function b(){h.onDOMReady(this.onReady,this,true)},onReady:function d(){if(!Alfresco.constants.DASHLET_RESIZE){return}this.dashlet=a.query("div.dashlet",c.get(this.id),true);if(!this.dashlet){return}c.addClass(this.dashlet,"resizable");this.dashletBody=a.query("div.body",this.dashlet,true);if(!this.dashletBody){return}var j=c.getStyle(this.dashlet,"height");if(j=="auto"){j=this.dashlet.offsetHeight-parseInt(c.getStyle(this.dashlet,"padding-bottom"),10)}else{j=parseInt(j,10)}this.heightDelta=j-parseInt(c.getStyle(this.dashletBody,"height"),10);this.widgets.resizer=new YAHOO.util.Resize(this.dashlet,{handles:["b"],minHeight:this.options.minDashletHeight,maxHeight:this.options.maxDashletHeight});this.widgets.resizer.on("resize",function(){this.onResize()},this,true);this.widgets.resizer.on("endResize",function(k){this.onEndResize(k.height)},this,true);c.setStyle(this.dashlet,"width","")},_hiddenOnResize:null,onResize:function e(){var k=parseInt(c.getStyle(this.dashlet,"height"),10)-this.heightDelta;this._hiddenOnResize=[];var m=this.dashletBody.getElementsByTagName("iframe");for(var l=0;l<m.length;l++){var j=c.getStyle(m[l],"visibility");if(j="visible"){this._hiddenOnResize.push(m[l]);c.setStyle(m[l],"visibility","hidden")}}c.setStyle(this.dashletBody,"height",k+"px");c.setStyle(this.dashletBody.getElementsByTagName("iframe"),"height",k+"px")},onEndResize:function g(k){c.setStyle(this.dashlet,"width","");for(var j=0;j<this._hiddenOnResize.length;j++){c.setStyle(this._hiddenOnResize[j],"visibility","visible")}this._hiddenOnResize={};Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.URL_SERVICECONTEXT+"modules/dashlet/config/"+this.dashletId,dataObj:{height:parseInt(c.getStyle(this.dashlet,"height"),10)-this.heightDelta},successCallback:function(){},successMessage:null,failureCallback:function(){},failureMessage:null})}}})();(function(){Alfresco.component.ShareFormManager=function c(d){Alfresco.component.ShareFormManager.superclass.constructor.call(this,d);this.name="Alfresco.component.ShareFormManager";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,Alfresco.component.ShareFormManager.superclass.options);return this};YAHOO.extend(Alfresco.component.ShareFormManager,Alfresco.component.FormManager,{pageUsesAjaxState:function a(d){return(d.match(/documentlibrary([?]|$)/)||d.match(/repository([?]|$)/)||d.match(/my-workflows([?]|$)/)||d.match(/my-tasks([?]|$)/))},getSiteDefaultUrl:function b(){return Alfresco.util.uriTemplate("userdashboardpage",{userid:encodeURIComponent(Alfresco.constants.USERNAME)})}})})();Alfresco.Share.userAvatar=function(b,a){var c=Alfresco.constants.URL_CONTEXT+"components/images/no-user-photo-64.png";if(b){c=Alfresco.constants.PROXY_URI+"slingshot/profile/avatar/"+encodeURIComponent(b);if(a===32){c+="/thumbnail/avatar32"}}return'<img src="'+c+'" alt="'+Alfresco.util.message("label.avatar")+'"/>'};(function(){var b=YAHOO.util.Dom,u=YAHOO.util.Event;var p=Alfresco.util.encodeHTML,q=Alfresco.util.activateLinks,e=Alfresco.util.userProfileLink,i=Alfresco.util.siteDashboardLink,d=Alfresco.util.relativeTime;var f=Alfresco.util.generateDomId(null,"favourite"),n=Alfresco.util.generateDomId(null,"like");Alfresco.component.SimpleDocList=function c(v){Alfresco.component.SimpleDocList.superclass.constructor.call(this,"Alfresco.component.SimpleDocList",v,["button","container","datasource","datatable","animation"]);this.previewTooltips=[];this.metadataTooltips=[];this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);return this};Alfresco.component.SimpleDocList.generateFavourite=function o(x,v){var y="favourite."+(v.getData("isFolder")?"folder.":"document."),w="";if(v.getData("isFavourite")){w='<a class="favourite-action '+f+' enabled" title="'+x.msg(y+"remove.tip")+'" tabindex="0"></a>'}else{w='<a class="favourite-action '+f+'" title="'+x.msg(y+"add.tip")+'" tabindex="0">'+x.msg(y+"add.label")+"</a>"}return w};Alfresco.component.SimpleDocList.generateLikes=function r(y,v){var w=v.getData("likes"),z="like."+(v.getData("isFolder")?"folder.":"document."),x="";if(w.isLiked){x='<a class="like-action '+n+' enabled" title="'+y.msg(z+"remove.tip")+'" tabindex="0"></a>'}else{x='<a class="like-action '+n+'" title="'+y.msg(z+"add.tip")+'" tabindex="0">'+y.msg(z+"add.label")+"</a>"}x+='<span class="likes-count">'+p(w.totalLikes)+"</span>";return x};Alfresco.component.SimpleDocList.generateComments=function h(y,v){var x=v.getData(),w=Alfresco.constants.URL_PAGECONTEXT+"site/"+x.location.site+"/"+(x.isFolder?"folder":"document")+"-details?nodeRef="+x.nodeRef+"#comment",z="comment."+(x.isFolder?"folder.":"document.");return'<a href="'+w+'" class="comment" title="'+y.msg(z+"tip")+'" tabindex="0">'+y.msg(z+"label")+"</a>"};YAHOO.extend(Alfresco.component.SimpleDocList,Alfresco.component.Base,{options:{showFileSize:true},previewTooltips:null,metadataTooltips:null,onReady:function l(){var A=this;this.widgets.previewTooltip=new YAHOO.widget.Tooltip(this.id+"-previewTooltip",{width:"108px"});this.widgets.previewTooltip.contextTriggerEvent.subscribe(function(G,E){var F=E[0],D=A.widgets.alfrescoDataTable.getData(F.id),H=Alfresco.constants.PROXY_URI+"api/node/"+D.nodeRef.replace(":/","")+"/content/thumbnails/doclib?c=queue&ph=true";this.cfg.setProperty("text",'<img src="'+H+'" />')});this.widgets.metadataTooltip=new YAHOO.widget.Tooltip(this.id+"-metadataTooltip");this.widgets.metadataTooltip.contextTriggerEvent.subscribe(function(H,F){var G=F[0],E=A.widgets.alfrescoDataTable.getData(G.id),D=E.location;var I="<em>"+A.msg("label.site")+":</em> "+p(D.siteTitle)+"<br />";I+="<em>"+A.msg("label.path")+":</em> "+p(D.path);this.cfg.setProperty("text",I)});this.widgets.alfrescoDataTable=new Alfresco.util.DataTable({dataSource:{url:this.getWebscriptUrl(),initialParameters:this.getParameters(),config:{responseSchema:{resultsList:"items"}}},dataTable:{container:this.id+"-documents",columnDefinitions:[{key:"thumbnail",sortable:false,formatter:this.bind(this.renderCellThumbnail),width:16},{key:"detail",sortable:false,formatter:this.bind(this.renderCellDetail)}],config:{className:"alfresco-datatable simple-doclist",renderLoopSize:4}}});var A=this,B=this.widgets.alfrescoDataTable.getDataTable(),z=B.doBeforeLoadData;B.doBeforeLoadData=function x(D,E,F){if(E.results.length===0){E.results.unshift({isInfo:true,title:A.msg("empty.title"),description:A.msg("empty.description")})}return z.apply(this,arguments)};B.subscribe("renderEvent",function(){this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips);this.widgets.metadataTooltip.cfg.setProperty("context",this.metadataTooltips)},this,true);var C=function w(F,E){var D=YAHOO.Bubbling.getOwnerByTagName(E[1].anchor,"div");if(D!==null){A.onFavourite.call(A,E[1].target.offsetParent,D)}return true};YAHOO.Bubbling.addDefaultAction(f,C);var v=function y(F,E){var D=YAHOO.Bubbling.getOwnerByTagName(E[1].anchor,"div");if(D!==null){A.onLikes.call(A,E[1].target.offsetParent,D)}return true};YAHOO.Bubbling.addDefaultAction(n,v)},getWebscriptUrl:function a(){return Alfresco.constants.PROXY_URI+"slingshot/doclib/doclist/documents/node/alfresco/sites/home?max=50"},getParameters:function m(){return""},reloadDataTable:function s(){this.previewTooltips=[];this.metadataTooltips=[];this.widgets.alfrescoDataTable.loadDataTable(this.getParameters())},renderCellThumbnail:function t(F,H,B,x){var y=40,z=H.getData(),A="";if(z.isInfo){y=52;A='<img src="'+Alfresco.constants.URL_RESCONTEXT+'components/images/help-docs-bw-32.png" />'}else{var v=z.fileName,C=v.substring(v.lastIndexOf(".")),D=z.location,E=new Alfresco.util.NodeRef(z.nodeRef),G=Alfresco.constants.URL_PAGECONTEXT+"site/"+D.site+"/document-details?nodeRef="+E.toString();if(this.options.simpleView){var w=this.id+"-preview-"+H.getId();A='<span id="'+w+'" class="icon32"><a href="'+G+'"><img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+Alfresco.util.getFileIcon(v)+'" alt="'+C+'" title="'+p(v)+'" /></a></span>';this.previewTooltips.push(w)}else{y=100;A='<span class="thumbnail"><a href="'+G+'"><img src="'+Alfresco.constants.PROXY_URI+"api/node/"+E.uri+'/content/thumbnails/doclib?c=queue&ph=true" alt="'+C+'" title="'+p(v)+'" /></a></span>'}}B.width=y;b.setStyle(F,"width",B.width+"px");b.setStyle(F.parentNode,"width",B.width+"px");F.innerHTML=A},renderCellDetail:function k(G,K,B,x){var z=K.getData(),A="";if(z.isInfo){A+='<div class="empty"><h3>'+z.title+"</h3>";A+="<span>"+z.description+"</span></div>"}else{var y=this.id+"-metadata-"+K.getId(),C="",H='<span class="faded">'+this.msg("details.description.none")+"</span>",E="",J=z.permissions.userAccess.create,D=z.location,F=new Alfresco.util.NodeRef(z.nodeRef),I=Alfresco.constants.URL_PAGECONTEXT+"site/"+D.site+"/document-details?nodeRef="+F.toString();if(z.description&&z.description!==""){H=q(p(z.description))}if(z.version&&z.version!==""){C='<span class="document-version">'+p(z.version)+"</span>"}var w="modified",v=z.modifiedOn;if(z.custom&&z.custom.isWorkingCopy){w="editing-started"}else{if(z.modifiedOn===z.createdOn){w="created";v=z.createdOn}}if(Alfresco.constants.SITE===""){E=this.msg("details."+w+"-in-site",d(v),i(D.site,D.siteTitle,'class="site-link theme-color-1" id="'+y+'"'))}else{E=this.msg("details."+w+"-by",d(v),e(z.modifiedByUser,z.modifiedBy,'class="theme-color-1"'))}if(this.options.simpleView){A+='<h3 class="filename simple-view"><a class="theme-color-1" href="'+I+'">'+p(z.displayName)+"</a></h3>";A+='<div class="detail"><span class="item-simple">'+E+"</span></div>"}else{A+='<h3 class="filename"><a class="theme-color-1" href="'+I+'">'+p(z.displayName)+"</a>"+C+"</h3>";A+='<div class="detail">';A+='<span class="item">'+E+"</span>";if(this.options.showFileSize){A+='<span class="item">'+Alfresco.util.formatFileSize(z.size)+"</span>"}A+="</div>";A+='<div class="detail"><span class="item">'+H+"</span></div>";A+='<div class="detail detail-social">';A+='<span class="item item-social">'+Alfresco.component.SimpleDocList.generateFavourite(this,K)+"</span>";A+='<span class="item item-social item-separator">'+Alfresco.component.SimpleDocList.generateLikes(this,K)+"</span>";if(J){A+='<span class="item item-social item-separator">'+Alfresco.component.SimpleDocList.generateComments(this,K)+"</span>"}A+="</div>"}this.metadataTooltips.push(y)}G.innerHTML=A},onLikes:function j(B){var y=this.widgets.alfrescoDataTable.getData(B),z=new Alfresco.util.NodeRef(y.nodeRef),w=y.likes;w.isLiked=!w.isLiked;w.totalLikes+=(w.isLiked?1:-1);var x={successCallback:{fn:function v(H,F){var I=H.json.data;if(I){var C=this.widgets.alfrescoDataTable.findRecordByParameter("nodeRef",F),G=C.getData(),D=G.likes;D.totalLikes=I.ratingsCount;this.widgets.alfrescoDataTable.getDataTable().updateRow(C,G);if(D.isLiked){var E={nodeRef:G.nodeRef};Alfresco.Share.postActivity(this.options.siteId,"file-liked",G.fileName,"document-details",E)}}},scope:this,obj:z.toString()},failureCallback:{fn:function A(G,E){var C=this.widgets.alfrescoDataTable.findRecordByParameter("nodeRef",E),F=C.getData(),D=F.likes;D.isLiked=!D.isLiked;D.totalLikes+=(D.isLiked?1:-1);this.widgets.alfrescoDataTable.getDataTable().updateRow(C,F);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",F.displayName)})},scope:this,obj:z.toString()}};if(w.isLiked){this.services.likes.set(z,1,x)}else{this.services.likes.remove(z,x)}this.widgets.alfrescoDataTable.getDataTable().updateRow(record,y)},onFavourite:function g(z){var v=this.widgets.alfrescoDataTable.getRecord(z),x=v.getData(),y=x.nodeRef;x.isFavourite=!x.isFavourite;this.widgets.alfrescoDataTable.getDataTable().updateRow(v,x);var w={failureCallback:{fn:function A(E,B){var C=this.widgets.alfrescoDataTable.getRecord(B),D=C.getData();D.isFavourite=!D.isFavourite;this.widgets.alfrescoDataTable.getDataTable().updateRow(C,D);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",D.displayName)})},scope:this,obj:z}};this.services.preferences[x.isFavourite?"add":"remove"].call(this.services.preferences,Alfresco.service.Preferences.FAVOURITE_DOCUMENTS,y,w)}})})();