var YUIDom=YAHOO.util.Dom,YUIEvent=YAHOO.util.Event,YUISelector=YAHOO.util.Selector,YUIKeyListener=YAHOO.util.KeyListener;if(typeof Alfresco=="undefined"||!Alfresco){var Alfresco={}}Alfresco.constants=Alfresco.constants||{};Alfresco.template=Alfresco.template||{};Alfresco.component=Alfresco.component||{};Alfresco.dashlet=Alfresco.dashlet||{};Alfresco.module=Alfresco.module||{};Alfresco.util=Alfresco.util||{};Alfresco.logger=Alfresco.logger||{};Alfresco.service=Alfresco.service||{};Alfresco.thirdparty=Alfresco.thirdparty||{};Alfresco.widget=Alfresco.widget||{};Alfresco.admin=Alfresco.admin||{};Alfresco.action=Alfresco.action||{};Alfresco.doclib=Alfresco.doclib||{MODE_SITE:0,MODE_REPOSITORY:1};Alfresco.messages=Alfresco.messages||{global:null,scope:{}};Alfresco.util.isBrowserPluginInstalled=function(a){return navigator.mimeTypes&&navigator.mimeTypes[a]&&navigator.mimeTypes[a].enabledPlugin};Alfresco.util.isSharePointPluginInstalled=function(){var a=Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit");var b=Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint");if(YAHOO.env.ua.webkit&&a){return true}return b!=undefined};Alfresco.util.appendArrayToObject=function(e,a,f){var d=(f!==undefined?f:true);if(YAHOO.lang.isObject(e)&&YAHOO.lang.isArray(a)){for(var b=0,c=a.length;b<c;b++){if(a[b]!==undefined){e[a[b]]=d}}}return e};Alfresco.util.arrayToObject=function(a,f){var e={},d=(f!==undefined?f:true);if(YAHOO.lang.isArray(a)){for(var b=0,c=a.length;b<c;b++){if(a[b]!==undefined){e[a[b]]=d}}}return e};Alfresco.util.deepCopy=function(g,h){if(!g){return g}if(!h){h={}}if(YAHOO.lang.isArray(g)){var f=[];for(var e=0,k=g.length,c;e<k;e++){c=g[e];if(!YAHOO.lang.isFunction(c)||h.copyFunctions==true){f.push(Alfresco.util.deepCopy(c,h))}}return f}if(Alfresco.util.isDate(g)){return new Date(g.getTime())}if(YAHOO.lang.isString(g)||YAHOO.lang.isNumber(g)||YAHOO.lang.isBoolean(g)){return g}if(YAHOO.lang.isObject(g)){if(g.toString()=="[object Object]"){var d={},b;for(var a in g){if(g.hasOwnProperty(a)){b=g[a];if(!YAHOO.lang.isFunction(b)||h.copyFunctions==true){d[a]=Alfresco.util.deepCopy(b,h)}}}return d}else{return g}}return null};Alfresco.util.isDate=function(a){return a.constructor&&a.constructor.toString().indexOf("Date")!=-1};Alfresco.util.objectMatchesPattern=function(c,b){for(var a in b){if(b.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||(c[a]!=b[a]&&b[a]!="*"))){return false}}return true};Alfresco.util.dotNotationToObject=function(h,f){var a={},g=a;if(typeof h==="string"){var c=h.split("."),e,b,d;for(b=0,d=c.length-1;b<d;b++){e=c[b];g[e]={};g=g[e]}g[c[b]]=f!==undefined?f:null}return a};Alfresco.util.findValueByDotNotation=function(g,f,a){var e=a?a:null;if(f&&g){var d=g;var c=f.split(".");for(var b=0;b<c.length;b++){d=d[c[b]];if(typeof d=="undefined"){return e}}return d}return e};Alfresco.util.substituteDotNotation=function(c,b){return YAHOO.lang.substitute(c,{},function a(e,f,d){return Alfresco.util.findValueByDotNotation(b,e)})};Alfresco.util.findInArray=function(b,d,a){var c=Alfresco.util.arrayIndex(b,d,a);return c!==-1?b[c]:null};Alfresco.util.arrayContains=function(a,b){return Alfresco.util.arrayIndex(a,b)!==-1};Alfresco.util.arrayRemove=function(a,c){var b=Alfresco.util.arrayIndex(a,c);while(b!==-1){a.splice(b,1);b=Alfresco.util.arrayIndex(a,c)}return a};Alfresco.util.arrayIndex=function(b,e,a){if(b){for(var c=0,d=b.length;c<d;c++){if(a){if(b[c]&&b[c][a]==e){return c}}else{if(b[c]==e){return c}}}}return -1};Alfresco.util.assertNotEmpty=function(b,a){if(typeof b=="undefined"||!b||b===""){throw new Error(a)}};Alfresco.util.isValueSet=function(a,b){if(YAHOO.lang.isUndefined(a)||YAHOO.lang.isNull(a)){return false}if(YAHOO.lang.isString(a)&&a.length===0&&!!b===false){return false}return true};Alfresco.util.combinePaths=function(){var c="",a,b;for(a=0,b=arguments.length;a<b;a++){if(arguments[a]!==null){c+=arguments[a]+(arguments[a]!=="/"?"/":"")}}c=c.replace(/(^|[^:])\/{2,}/g,"$1/");if(arguments.length>0&&!(typeof arguments[arguments.length-1]==="undefined")&&arguments[arguments.length-1].match(/(.)\/$/)===null){c=c.replace(/(.)\/$/g,"$1")}return c};Alfresco.util.BYTES_KB=1024;Alfresco.util.BYTES_MB=1048576;Alfresco.util.BYTES_GB=1073741824;Alfresco.util.formatFileSize=function(a){if(typeof a=="string"){a=parseInt(a,10)}if(a<Alfresco.util.BYTES_KB){return a+" "+Alfresco.util.message("size.bytes")}else{if(a<Alfresco.util.BYTES_MB){a=Math.round(a/Alfresco.util.BYTES_KB);return a+" "+Alfresco.util.message("size.kilobytes")}else{if(a<Alfresco.util.BYTES_GB){a=Math.round(a/Alfresco.util.BYTES_MB);return a+" "+Alfresco.util.message("size.megabytes")}}}a=Math.round(a/Alfresco.util.BYTES_GB);return a+" "+Alfresco.util.message("size.gigabytes")};Alfresco.util.getFileIcon=function(c,a,g){var h={aep:"aep",ai:"ai",aiff:"aiff",asf:"video",asnd:"asnd",asx:"video",au:"audio",avi:"video",avx:"video",bmp:"img",css:"text",divx:"video",doc:"doc",docx:"doc",eml:"eml",fla:"fla",flv:"video",fxp:"fxp",gif:"img",htm:"html",html:"html",indd:"indd",jpeg:"img",jpg:"img",key:"key",mkv:"video",mov:"video",movie:"video",mp3:"mp3",mp4:"video",mpeg:"video",mpeg2:"video",mpv2:"video",numbers:"numbers",odg:"odg",odp:"odp",ods:"ods",odt:"odt",ogg:"video",ogv:"video",pages:"pages",pdf:"pdf",png:"img",ppj:"ppj",ppt:"ppt",pptx:"ppt",psd:"psd",qt:"video",rtf:"rtf",snd:"audio",spx:"audio",svg:"img",swf:"swf",tiff:"img",txt:"text",wav:"audio",webm:"video",wmv:"video",xls:"xls",xlsx:"xls",xml:"xml",xvid:"video",zip:"zip"};var b="generic",k=typeof a==="string"?a:"cm:content",e=typeof g==="number"?g:32;var f=Alfresco.util.getFileIcon.types[k];if(f==="file"){var d=c.substring(c.lastIndexOf(".")+1).toLowerCase();if(d in h){b=h[d]}}else{if(typeof f=="undefined"){f="file"}}return b+"-"+f+"-"+e+".png"};Alfresco.util.getFileIcon.types={"{http://www.alfresco.org/model/content/1.0}cmobject":"file","cm:cmobject":"file","{http://www.alfresco.org/model/content/1.0}content":"file","cm:content":"file","{http://www.alfresco.org/model/content/1.0}thumbnail":"file","cm:thumbnail":"file","{http://www.alfresco.org/model/content/1.0}folder":"folder","cm:folder":"folder","{http://www.alfresco.org/model/content/1.0}category":"category","cm:category":"category","{http://www.alfresco.org/model/content/1.0}person":"user","cm:person":"user","{http://www.alfresco.org/model/content/1.0}authorityContainer":"group","cm:authorityContainer":"group",tag:"tag","{http://www.alfresco.org/model/site/1.0}sites":"site","st:sites":"site","{http://www.alfresco.org/model/site/1.0}site":"site","st:site":"site","{http://www.alfresco.org/model/transfer/1.0}transferGroup":"server-group","trx:transferGroup":"server-group","{http://www.alfresco.org/model/transfer/1.0}transferTarget":"server","trx:transferTarget":"server"};Alfresco.util.getFileExtension=function(b){var a=(new String(b)).match(/^.*\.([^\.]*)$/);if(YAHOO.lang.isArray(a)&&YAHOO.lang.isString(a[1])){return a[1]}return null};Alfresco.util.getScrollPosition=function(){if(YAHOO.env.ua.ie>0){if(document.compatMode&&document.compatMode!="BackCompat"){return[document.documentElement.scrollLeft,document.documentElement.scrollTop]}else{return[document.body.scrollLeft,document.body.scrollTop]}}else{return[window.scrollX,window.scrollY]}};Alfresco.util.formatDate=function(a){try{return Alfresco.thirdparty.dateFormat.apply(this,arguments)}catch(b){return a}};Alfresco.util.fromISO8601=function(a){try{return Alfresco.thirdparty.fromISO8601.apply(this,arguments)}catch(b){return null}};Alfresco.util.toISO8601=function(a){try{return Alfresco.thirdparty.toISO8601.apply(this,arguments)}catch(b){return""}};Alfresco.util.fromExplodedJSONDate=function(b){try{var a=YAHOO.lang.substitute("{year 4}-{month 2}-{date 2}T{hours 2}:{minutes 2}:{seconds 2}.{milliseconds 3}Z",b,function(f,g,e){if(f=="month"){++g}g=String(g);var d=parseInt(e,10)||2;while(g.length<d){g="0"+g}return g});return Alfresco.thirdparty.fromISO8601.apply(this,[a,Array.prototype.slice.call(arguments).slice(1)])}catch(c){return null}};Alfresco.util.toExplodedJSONDate=function(a){return({zone:"UTC",year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds(),milliseconds:a.getMilliseconds()})};Alfresco.util.relativeTime=function(h,k){if(YAHOO.lang.isString(h)){h=Alfresco.util.fromISO8601(h)}else{if(!(h instanceof Date)){return""}}if(YAHOO.lang.isUndefined(k)){k=new Date()}else{if(YAHOO.lang.isString(k)){k=Alfresco.util.fromISO8601(k)}}var l=Alfresco.util.message,e=((k-h)/1000),g=Math.floor(e/60),c=function m(){return'<span title="'+Alfresco.util.formatDate(h)+'">'+l.apply(this,arguments)+"</span>"};if(g<=0){return c("relative.seconds",this,e)}if(g==1){return c("relative.minute",this)}if(g<45){return c("relative.minutes",this,g)}if(g<90){return c("relative.hour",this)}var a=Math.round(g/60);if(g<1440){return c("relative.hours",this,a)}if(g<2880){return c("relative.day",this)}var b=Math.round(g/1440);if(g<43200){return c("relative.days",this,b)}if(g<86400){return c("relative.month",this)}var f=Math.round(g/43200);if(g<525960){return c("relative.months",this,f)}if(g<1051920){return c("relative.year",this)}var d=Math.round(g/525960);return c("relative.years",this,d)};Alfresco.util.friendlyDate=function(f,h){var k=Alfresco.util.message,e=new Date(),b=Alfresco.thirdparty.dateFormat,g=YAHOO.widget.DateMath,l=Alfresco.thirdparty.dateFormat.masks.isoDate,a=b(f,l),d=b(e,l),c=b(g.add(e,g.DAY,-1),l),m=b(g.add(e,g.DAY,1),l);result="";switch(a){case d:result=k("dateFormat.friendly.today");break;case c:result=k("dateFormat.friendly.yesterday");break;case m:result=k("dateFormat.friendly.tomorrow");break;default:result=b(f,h)}return result};Alfresco.util.pad=function(b,a){b=String(b);a=parseInt(a,10)||2;while(b.length<a){b="0"+b}return b};Alfresco.util.insertAtCursor=function(b,a){if(document.selection){b.focus();document.selection.createRange().text=a}else{if(b.selectionStart||b.selectionStart=="0"){b.value=b.value.substring(0,b.selectionStart)+a+b.value.substring(b.selectionEnd,b.value.length)}else{b.value+=a}}b.focus()};Alfresco.util.selectText=function(d,a,b){if(d.setSelectionRange){d.setSelectionRange(a,b)}else{if(d.createTextRange){var c=d.createTextRange();c.moveStart("character",a);c.moveEnd("character",b-d.value.length);c.select()}else{d.select()}}};Alfresco.util.isVisible=function(b){try{while(b){if(b.tagName){if(b.tagName.toLowerCase()=="body"){return true}}if(YUIDom.getStyle(b,"display")=="none"||YUIDom.getStyle(b,"visibility")=="hidden"){return false}b=b.parentNode}}catch(a){return false}return true};Alfresco.util.decodeHTML=function(a){if(a===null){return""}return a.split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&").split("&quot;").join('"')};Alfresco.util.encodeHTML=function(d,b){if(d===null||typeof d=="undefined"){return""}var a=b===true?"":"&nbsp;&nbsp;&nbsp;";if(YAHOO.env.ua.ie>0){d=""+d;return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"+a).replace(/"/g,"&quot;")}var c=arguments.callee;c.text.data=d;return c.div.innerHTML.replace(/\n/g,"<br />"+a).replace(/"/g,"&quot;")};Alfresco.util.encodeHTML.div=document.createElement("div");Alfresco.util.encodeHTML.text=document.createTextNode("");Alfresco.util.encodeHTML.div.appendChild(Alfresco.util.encodeHTML.text);Alfresco.util.encodeURIPath=function(a){return encodeURIComponent(a).replace(/%2F/g,"/")};Alfresco.util.activateLinks=function(b){var a=new RegExp(/((http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?\^=%&:\/~\+#]*[\w\-\@?\^=%&\/~\+#])?)/g);b=b.replace(a,'<a href="$1" target="_blank">$1</a>');return b};Alfresco.util.tweetToHTML=function(b){b=Alfresco.util.activateLinks(b);var a=new RegExp(/(^|[^\w])@([\w]{1,})/g);b=b.replace(a,'$1<a href="http://twitter.com/$2">@$2</a>');a=new RegExp(/#+([\w]{1,})/g);b=b.replace(a,'<a href="http://search.twitter.com/search?q=%23$1">#$1</a>');return b};Alfresco.util.setSelectedIndex=function(d,c){for(var b=0,a=d.options.length;b<a;b++){if(d.options[b].value==c){d.selectedIndex=b;return d.options[b].text}}return null};Alfresco.util.setSelectedClass=function(e,g,d){var c=e.childNodes,f=null;d=d?d:"selected";for(var b=0,a=c.length;b<a;b++){f=c[b];if(!g||f.tagName==g.tagName){YUIDom.removeClass(f,d);if(f===g){YUIDom.addClass(f,d)}}}};Alfresco.util.useAsButton=function(f,b,c,a){YAHOO.util.Event.addListener(f,"click",b,c,a);if(YAHOO.lang.isString(f)){f=YAHOO.util.Dom.get(f)}if(!f.getAttribute("tabindex")){f.setAttribute("tabindex","0")}var e=b,g=c,d=a||f;var h=function(l,k){e.call(d,l,g||k)};new YAHOO.util.KeyListener(f,{keys:[YAHOO.util.KeyListener.KEY.ENTER]},h).enable()};Alfresco.util.generateDomId=function(b,a){var d,c=a||"alf-id";do{d=c+Alfresco.util.generateDomId._nId++}while(YUIDom.get(d)!==null);Alfresco.util.setDomId(b,d);return d};Alfresco.util.generateDomId._nId=0;Alfresco.util.setDomId=function(b,a){if(b){if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<8){b.attributes.id.value=a;b.setAttribute("id",a)}else{b.setAttribute("id",a)}}};Alfresco.util.relToTarget=function(d){var c=YUISelector.query("a[rel]",d);for(var a=0,b=c.length;a<b;a++){c[a].setAttribute("target",c[a].getAttribute("rel"))}};Alfresco.util.populateHTML=function(){for(var a=0,c=arguments.length,b=null;a<c;a++){b=YUIDom.get(arguments[a][0]);if(b){b.innerHTML=arguments[a][1]}}};Alfresco.util.hasCssProperty=function(b){if(Alfresco.util.hasCssProperty.div.style.hasOwnProperty(b)){return true}b=b.replace(/^[a-z]/,function(c){return c.toUpperCase()});var a=Alfresco.util.hasCssProperty.vendors.length;while(a--){if(Alfresco.util.hasCssProperty.div.style.hasOwnProperty(vendors[a]+b)){return true}}return false};Alfresco.util.hasCssProperty.div=document.createElement("div");Alfresco.util.hasCssProperty.vendors=["Khtml","O","ms","Moz","Webkit"];Alfresco.util.createYUIButton=function(g,b,a,h,e){var f={type:"button",disabled:false};if(typeof h=="object"){f=YAHOO.lang.merge(f,h)}if((f.type=="menu")&&(typeof f.menu=="string")){f.menu=g.id+"-"+f.menu}var d=e?e:g.id+"-"+b,c=null;if(YUIDom.get(d)!==null){c=new YAHOO.widget.Button(d,f);if(typeof c=="object"){if(typeof a=="function"){if(f.type=="menu"){c.getMenu().subscribe("click",a,g,true);c.getMenu().subscribe("keydown",function(l,k,m){if(k[0].keyCode==YUIKeyListener.KEY.ENTER){this.hide();m.fn.call(m.scope,l,k)}},{scope:g,fn:a})}else{if(f.type=="checkbox"){c.on("checkedChange",a,c,g)}else{c.on("click",a,c,g)}}}if(typeof f.htmlName!="undefined"){c.get("element").getElementsByTagName("button")[0].name=f.htmlName}}}return c};Alfresco.util.disableYUIButton=function(a){if(a.set&&a.get){a.set("disabled",true);if(a.get("type")=="link"){a.set("href","");if(a._button&&a._button.setAttribute){a._button.setAttribute("onclick","return false;")}a.addStateCSSClasses("disabled");a.removeStateCSSClasses("hover");a.removeStateCSSClasses("active");a.removeStateCSSClasses("focus")}}};Alfresco.util.enableYUIButton=function(a){if(a.set&&a.get){a.set("disabled",false);if(a.get("type")=="link"){if(a._button&&a._button.removeAttribute){a._button.removeAttribute("onclick")}a.removeStateCSSClasses("disabled")}}};Alfresco.util.createTwister=function(h,g,e){var c={panel:null,CLASS_BASE:"alfresco-twister",CLASS_OPEN:"alfresco-twister-open",CLASS_CLOSED:"alfresco-twister-closed"};var b,k,a=YAHOO.lang.merge(c,e||{});b=YUIDom.get(h);if(b===null){return false}if(a.panel&&YUIDom.get(a.panel)){k=YUIDom.get(a.panel)}else{k=b.nextSibling;while(k.nodeType!==1&&k!==null){k=k.nextSibling}}if(k===null){return false}var f=Alfresco.util.arrayToObject(Alfresco.util.createTwister.collapsed.split(",")),d=!!f[g];YUIDom.addClass(b,a.CLASS_BASE);YUIDom.addClass(b,d?a.CLASS_CLOSED:a.CLASS_OPEN);YUIDom.setStyle(k,"display",d?"none":"block");YUIEvent.addListener(b,"click",function(o,p){if(o.target==o.currentTarget){var n=YUIDom.hasClass(p.controller,a.CLASS_OPEN);if(n){YUIDom.replaceClass(p.controller,a.CLASS_OPEN,a.CLASS_CLOSED)}else{YUIDom.replaceClass(p.controller,a.CLASS_CLOSED,a.CLASS_OPEN)}YUIDom.setStyle(p.panel,"display",n?"none":"block");if(p.filterName){var m=n?"add":"remove",l=new Alfresco.service.Preferences();l[m].call(l,Alfresco.service.Preferences.COLLAPSED_TWISTERS,p.filterName)}}},{controller:b,panel:k,filterName:g})};Alfresco.util.createTwister.collapsed="";Alfresco.util.createYUIPanel=function(d,c,b){var a,f={modal:true,constraintoviewport:true,draggable:true,fixedcenter:YAHOO.env.ua.mobile===null?"contained":false,close:true,visible:false,postmethod:"none"},e={render:true,type:YAHOO.widget.Dialog};if(typeof c=="object"){f=YAHOO.lang.merge(f,c)}if(typeof b=="object"){e=YAHOO.lang.merge(e,b)}a=new (e.type)(d,f);if(e.render){a.render(document.body)}a.subscribe("show",function(h,g){if(!f.fixedcenter){a.center()}YAHOO.Bubbling.fire("showPanel",{panel:this})});a.subscribe("hide",function(h,g){YAHOO.Bubbling.fire("hidePanel",{panel:this})});return a};Alfresco.util.createBalloon=function(b,c){var a=YUIDom.get(b);if(YAHOO.lang.isNull(a)){return null}c=YAHOO.lang.merge({effectType:YAHOO.widget.ContainerEffect.FADE,effectDuration:0.25,html:"",text:"",closeButton:true,width:"30em"},c||{});return(new Alfresco.widget.Balloon(a,c))};(function(){var g=YAHOO.util.Dom,b=YAHOO.util.Event;var a=Alfresco.util.encodeHTML,d=(YAHOO.widget.Module.prototype.platform==="mac"&&0<YAHOO.env.ua.gecko&&YAHOO.env.ua.gecko<2);Alfresco.widget.Balloon=function(l,m){var p=new YAHOO.widget.Overlay(Alfresco.util.generateDomId(),{context:[l,"bl","tl",["beforeShow","windowResize"]],constraintoviewport:true,visible:false,width:m.width||"30em",effect:{effect:m.effectType,duration:m.effectDuration}});if(d){p.hideEvent.unsubscribe(p.hideMacGeckoScrollbars,p,true);p.showEvent.unsubscribe(p.showMacGeckoScrollbars,p,true);p.hideMacGeckoScrollbars=function(){g.replaceClass(this.element,"prevent-scrollbars","hide-scrollbars")},p.showMacGeckoScrollbars=function(){g.replaceClass(this.element,"hide-scrollbars","prevent-scrollbars")}}var q=document.createElement("div"),o=document.createElement("div");g.addClass(q,"balloon");g.addClass(o,"balloon-arrow");if(m.closeButton){var k=document.createElement("div");k.innerHTML="X";g.addClass(k,"closeButton");b.addListener(k,"click",this.hide,this,true);q.appendChild(k)}var n=document.createElement("div");g.addClass(n,"text");n.innerHTML=m.html||a(m.text);q.appendChild(n);q.appendChild(o);p.setBody(q);p.render(g.get("doc3"));this.balloon=p;this.content=n;this.onClose=new YAHOO.util.CustomEvent("close",this);this.onShow=new YAHOO.util.CustomEvent("show",this);return this};Alfresco.widget.Balloon.prototype={balloon:null,content:null,hide:function f(){this.balloon.hide();this.onClose.fire()},show:function c(){this.balloon.show();this.balloon.bringToTop();this.onShow.fire()},html:function e(k){this.content.innerHTML=k;this.balloon.align()},text:function h(k){this.content.innerHTML=a(k);this.balloon.align()}}})();Alfresco.util.createInsituEditor=function(b,d,c){var a=YUIDom.get(b);if(YAHOO.lang.isNull(a)){return false}d=YAHOO.lang.merge({showDelay:600,hideDelay:600,autoDismissDelay:0,container:null,context:a,callback:c,error:null,disabled:false,type:"textBox",nodeRef:null,name:null,value:"",title:null},d||{});if(Alfresco.widget.InsituEditor[d.type]){return(new Alfresco.widget.InsituEditor[d.type](d))}return null};(function(){var a=YAHOO.util.Dom,D=YAHOO.util.Event,t=YAHOO.util.Element,m=YAHOO.util.KeyListener;Alfresco.widget.InsituEditorIcon=function(E,F){this.editor=E;this.params=YAHOO.lang.merge({},F);this.disabled=F.disabled;this.editIcon=document.createElement("span");this.editIcon.title=Alfresco.util.encodeHTML(F.title);a.addClass(this.editIcon,"insitu-edit");if(this.params.container!==null){a.get(this.params.container).appendChild(this.editIcon)}else{this.params.context.parentNode.insertBefore(this.editIcon,this.params.context)}D.on(this.params.context,"mouseover",this.onContextMouseOver,this);D.on(this.params.context,"mouseout",this.onContextMouseOut,this);D.on(this.editIcon,"mouseover",this.onContextMouseOver,this);D.on(this.editIcon,"mouseout",this.onContextMouseOut,this)};Alfresco.widget.InsituEditorIcon.prototype={disabled:null,_fadeOut:function v(E){var F=new YAHOO.util.Anim(E,{opacity:{to:0}},0.2);F.onComplete.subscribe(function(I,G,H){D.removeListener(H.editIcon,"click");a.setStyle(E,"visibility","hidden");a.setStyle(E,"opacity",0)},this);F.animate()},_fadeIn:function l(E){var F=new YAHOO.util.Anim(E,{opacity:{to:1}},0.2);F.onComplete.subscribe(function(I,G,H){a.setStyle(E,"opacity",1);D.removeListener(H.editIcon,"click");D.on(H.editIcon,"click",H.onIconClick,H)},this);a.setStyle(E,"visibility","visible");F.animate()},onContextMouseOver:function B(F,E){if(E.disabled){return}if(E.hideProcId){clearTimeout(E.hideProcId);E.hideProcId=null}E.showProcId=E.doIconShow(F,this)},onContextMouseOut:function b(F,E){if(E.disabled){return}if(E.showProcId){clearTimeout(E.showProcId);E.showProcId=null}if(E.hideProcId){clearTimeout(E.hideProcId);E.hideProcId=null}E.hideProcId=setTimeout(function(){E._fadeOut(E.editIcon)},E.params.hideDelay)},onIconClick:function p(F,E){if(E.disabled){return}Alfresco.logger.debug("onIconClick",F);E.editor.doShow();D.stopEvent(F)},doIconShow:function f(G,E){var F=this;return window.setTimeout(function(){F._fadeIn(F.editIcon);F.hideProcId=F.doHide()},F.params.showDelay)},doHide:function r(){if(this.params.autoDismissDelay<1){return null}var E=this;return window.setTimeout(function(){E._fadeOut(E.editIcon)},E.params.autoDismissDelay)}};Alfresco.widget.InsituEditor={};Alfresco.widget.InsituEditor.base=function(F){this.params=YAHOO.lang.merge({},F);var G=new Alfresco.util.NodeRef(this.params.nodeRef),E=new t(document.createElement("form"),{id:Alfresco.util.generateDomId(),method:"post",action:Alfresco.constants.PROXY_URI+"api/node/"+G.uri+"/formprocessor"});this.elEditForm=E;this.editForm=E.get("element");this.form=new Alfresco.forms.Form(this.editForm);this.form.setAJAXSubmit(true,{successCallback:{fn:this.onPersistSuccess,scope:this},failureCallback:{fn:this.onPersistFailure,scope:this}});this.form.setSubmitAsJSON(true);E.addClass("insitu-edit");E.on("submit",function(H){D.stopEvent(H)});this.editorIcon=new Alfresco.widget.InsituEditorIcon(this,F);this.params.context.parentNode.insertBefore(this.editForm,this.params.context);return this};Alfresco.widget.InsituEditor.base.prototype={params:null,elEditForm:null,editForm:null,form:null,_jsonCall:function s(H,G,E,F){F=F||{};Alfresco.util.Ajax.jsonRequest({method:H,url:G,dataObj:E,successCallback:F.successCallback,successMessage:F.successMessage,failureCallback:F.failureCallback,failureMessage:F.failureMessage,noReloadOnAuthFailure:F.noReloadOnAuthFailure||false})},doShow:function A(){Alfresco.logger.debug("Alfresco.widget.InsituEditor","Abstract implementation 'doShow()' not overridden")},doHide:function k(E){Alfresco.logger.debug("Alfresco.widget.InsituEditor","Abstract implementation 'doHide()' not overridden")},onPersistSuccess:function d(F){var E=true;if(this.params.callback.fn){E=this.params.callback.fn.call(this.params.callback.scope||this,F,this.params.callback.obj)}this.doHide(E)},onPersistFailure:function u(E){if(this.params.error&&this.params.error.fn){this.params.error.fn.call(this.params.error.scope||this,E,this.params.error.obj)}}};Alfresco.widget.InsituEditor.textBox=function(E){Alfresco.widget.InsituEditor.textBox.superclass.constructor.call(this,E);this.balloon=null;this.suppressInputBoxFocus=false;this.contextStyle=null;this.keyListener=null;this.markupGenerated=false;return this};YAHOO.extend(Alfresco.widget.InsituEditor.textBox,Alfresco.widget.InsituEditor.base,{balloon:null,suppressInputBoxFocus:null,contextStyle:null,keyListener:null,markupGenerated:null,doShow:function g(){this._generateMarkup();if(this.contextStyle===null){this.contextStyle=a.getStyle(this.params.context,"display")}a.setStyle(this.params.context,"display","none");a.setStyle(this.editForm,"display","inline");this.keyListener.enable();if(typeof this.params.fnSelect==="function"){this.params.fnSelect(this.inputBox,this.params.value)}else{this.inputBox.select()}},doHide:function z(E){this.balloon.hide();this.keyListener.disable();if(E){a.setStyle(this.editForm,"display","none");a.setStyle(this.params.context,"display",this.contextStyle)}},onPersistFailure:function c(E){Alfresco.widget.InsituEditor.textBox.superclass.onPersistFailure.call(this,E);this.balloon.text(this.params.errorMessage);this.balloon.show()},_generateMarkup:function h(){if(this.markupGenerated){return}var L=new t(document.createElement("input"),{type:"text",name:this.params.name,value:this.params.value}),H=new t(document.createElement("a"),{href:"#",innerHTML:Alfresco.util.message("button.save")}),F=new t(document.createElement("a"),{href:"#",innerHTML:Alfresco.util.message("button.cancel")});this.elEditForm.appendChild(L);this.elEditForm.appendChild(H);this.elEditForm.appendChild(F);L.on("blur",function(M){if(this.balloon){this.suppressInputBoxFocus=true;this.balloon.hide()}this.suppressInputBoxFocus=false},this,true);H.on("click",function(M){this.form._submitInvoked(M)},this,true);F.on("click",function(M){D.stopEvent(M);this.inputBox.value=this.params.value;this.doHide(true)},this,true);this.inputBox=L.get("element");this.keyListener=new m(this.inputBox,{keys:[m.KEY.ESCAPE]},{fn:function(N,M){D.stopEvent(M[1]);this.inputBox.value=this.params.value;this.doHide(true)},scope:this,correctScope:true});this.balloon=Alfresco.util.createBalloon(this.inputBox);this.balloon.onClose.subscribe(function(M){try{if(!this.suppressInputBoxFocus){this.inputBox.focus()}}catch(M){}},this,true);var K=this.params.validations;for(var G=0,J=K.length;G<J;G++){this.form.addValidation(this.inputBox,K[G].type,K[G].args,K[G].when,K[G].message)}var I=this;this.form.addError=function E(N,M){I.balloon.html(N);I.balloon.show()};this.form.init();this.markupGenerated=true}});Alfresco.widget.InsituEditor.tagEditor=function(E){Alfresco.widget.InsituEditor.tagEditor.superclass.constructor.call(this,E);this.balloon=null;this.suppressInputBoxFocus=false;this.contextStyle=null;this.keyListener=null;this.markupGenerated=false;return this};YAHOO.extend(Alfresco.widget.InsituEditor.tagEditor,Alfresco.widget.InsituEditor.base,{balloon:null,suppressInputBoxFocus:null,contextStyle:null,keyListener:null,tagRefs:null,hiddenInput:null,newTagInput:null,currentTags:null,markupGenerated:null,tagAutoComplete:null,_editingTagIndex:-1,_tagPrimedForDelete:false,doShow:function C(){this._generateMarkup();if(this.contextStyle===null){this.contextStyle=a.getStyle(this.params.context,"display")}a.setStyle(this.params.context,"display","none");a.setStyle(this.editForm,"display","inline");this.keyListener.enable();this.inputBox.select()},doHide:function n(E){this.balloon.hide();this.keyListener.disable();if(E){a.setStyle(this.editForm,"display","none");a.setStyle(this.params.context,"display",this.contextStyle)}},onPersistSuccess:function d(F){var E=true;if(this.params.callback.fn){E=this.params.callback.fn.call(this.params.callback.scope||this,F,this.params.callback.obj)}this.doHide(E);window.setTimeout(function(){YAHOO.Bubbling.fire("tagRefresh")},1000)},onPersistFailure:function x(E){Alfresco.widget.InsituEditor.textBox.superclass.onPersistFailure.call(this,E);this.balloon.text(this.params.errorMessage);this.balloon.show()},_addTag:function w(M,N){tag=Alfresco.util.encodeHTML(M);var O=document.createElement("span");YUIDom.addClass(O,"inlineTagEditTag");var L=document.createElement("span");L.innerHTML=tag;var I=document.createElement("img"),K=document.createElement("img");YUIDom.setAttribute(I,"src",Alfresco.constants.URL_RESCONTEXT+"components/images/delete-tag-off.png");YUIDom.setAttribute(I,"width",16);YUIDom.setAttribute(K,"src",Alfresco.constants.URL_RESCONTEXT+"components/images/delete-tag-on.png");YUIDom.setAttribute(K,"width",16);YUIDom.addClass(K,"hidden");O.appendChild(L);O.appendChild(I);O.appendChild(K);if(YUIDom.isAncestor(this.currentTags,this.newTagInput)){YUIDom.insertBefore(O,this.newTagInput.parentNode)}else{this.currentTags.appendChild(O)}this._editingTagIndex=-1;var J=function F(Q){var R=0,P=Q;while((P=P.previousSibling)!=null){R++}return R};var H=this;var G=function E(Q){var P=Alfresco.util.arrayIndex(H.tagRefs,Q);if(P!=-1){H.tagRefs.splice(P,1)}};D.addListener(I,"click",function(P){G(N);YUIDom.setAttribute(H.hiddenInput,"value",H.tagRefs.toString());H.currentTags.removeChild(O)});D.addListener(L,"click",function(P){YUIDom.insertBefore(H.newTagInput.parentNode,O);H.currentTags.removeChild(O);H.newTagInput.value=M;G(N);H._editingTagIndex=J(O)});return J(O)},_applyTag:function o(F,G){var E=this._addTag(F,G);this.newTagInput.value="";this.tagRefs.splice(E,0,G);YUIDom.setAttribute(this.hiddenInput,"value",this.tagRefs.toString());this.tagAutoComplete.collapseContainer()},_generateCurrentTagMarkup:function e(){if(this.currentTags.hasChildNodes()){while(this.currentTags.childNodes.length>=1){this.currentTags.removeChild(this.currentTags.firstChild)}}if(this.params.value!=undefined){for(i=0,j=this.params.value.length;i<j;i++){this._addTag(this.params.value[i].name,this.params.value[i].nodeRef);this.tagRefs.push(this.params.value[i].nodeRef)}}},_generateMarkup:function y(){this.tagRefs=[];if(this.markupGenerated){this._generateCurrentTagMarkup();return}var I=document.createElement("span"),E=document.createElement("div"),F=new t(document.createElement("a"),{href:"#",innerHTML:Alfresco.util.message("button.save")}),M=new t(document.createElement("a"),{href:"#",innerHTML:Alfresco.util.message("button.cancel")});this.hiddenInput=document.createElement("input");YUIDom.setAttribute(this.hiddenInput,"type","hidden");YUIDom.setAttribute(this.hiddenInput,"name",this.params.name);this.newTagInput=document.createElement("input");YUIDom.setAttribute(this.newTagInput,"type","text");I.appendChild(this.newTagInput);I.appendChild(E);var K=document.createElement("div");YUIDom.addClass(K,"inlineTagEdit");this.currentTags=document.createElement("span");K.appendChild(this.currentTags);K.appendChild(I);this._generateCurrentTagMarkup();YUIDom.setAttribute(this.hiddenInput,"value",this.tagRefs.toString());this.elEditForm.appendChild(K);YUIDom.addClass(I,"inlineTagEditAutoCompleteWrapper");YUIDom.addClass(E,"inlineTagEditAutoComplete");this.elEditForm.appendChild(this.hiddenInput);this.elEditForm.appendChild(F);this.elEditForm.appendChild(M);var N=new YAHOO.util.XHRDataSource(Alfresco.constants.PROXY_URI+"api/forms/picker/category/workspace/SpacesStore/tag:tag-root/children?selectableType=cm:category&searchTerm=&size=100&aspect=cm:taggable&");N.responseType=YAHOO.util.XHRDataSource.TYPE_JSON;N.responseSchema={resultsList:"data.items",fields:["name","nodeRef"]};this.tagAutoComplete=new YAHOO.widget.AutoComplete(this.newTagInput,E,N);this.tagAutoComplete.questionMark=false;this.tagAutoComplete.applyLocalFilter=true;this.tagAutoComplete.queryDelay=0.1;this.tagAutoComplete.animSpeed=0.08;this.tagAutoComplete.itemSelectEvent.subscribe(function(T,Q){var R=Q[2][0],S=Q[2][1];this._applyTag(R,S);if(YUIDom.isAncestor(this.currentTags,this.newTagInput)){YUIDom.insertAfter(this.newTagInput.parentNode,this.currentTags)}},this,true);this.tagAutoComplete.dataReturnEvent.subscribe(function(T,R){var S=R[2];for(H=0,j=S.length;H<j;H++){var U=S[H].nodeRef;var Q=Alfresco.util.arrayIndex(this.tagRefs,U);if(Q!=-1){S.splice(H,1);H--;j--}}},this,true);var J=this;D.addListener(this.newTagInput,"keypress",function(Q){if(Q.keyCode==13&&this.value.length>0){D.stopEvent(Q);J._createTag(this.value,false)}});var J=this;D.addListener(this.newTagInput,"keydown",function(R){if(R.keyCode==8&&this.newTagInput.value.length==0){if(this._editingTagIndex!=-1){this.tagRefs.splice(this._editingTagIndex,1);YUIDom.insertAfter(this.newTagInput.parentNode,this.currentTags)}else{if(!this._tagPrimedForDelete&&this.currentTags.children.length>0){this._tagPrimedForDelete=true;var Q=YUIDom.getLastChild(this.currentTags);YUIDom.addClass(Q,"inlineTagEditTagPrimed");YUIDom.addClass(Q.children[1],"hidden");YUIDom.removeClass(Q.children[2],"hidden")}else{if(this.tagRefs.length>0){this.tagRefs.pop();YUIDom.setAttribute(this.hiddenInput,"value",this.tagRefs.toString());this.currentTags.removeChild(YUIDom.getLastChild(this.currentTags))}this._tagPrimedForDelete=false}}}else{if(this._tagPrimedForDelete==true){this._tagPrimedForDelete=false;if(this.currentTags.children.length>0){var Q=YUIDom.getLastChild(this.currentTags);YUIDom.removeClass(Q,"inlineTagEditTagPrimed");YUIDom.addClass(Q.children[2],"hidden");YUIDom.removeClass(Q.children[1],"hidden")}}}},this,true);D.addListener(K,"click",function(Q){this.newTagInput.select()},this,true);D.addListener(this.newTagInput,"blur",function(Q){if(this.balloon){this.suppressInputBoxFocus=true;this.balloon.hide()}this.suppressInputBoxFocus=false},this,true);F.on("click",function(Q){if(this.newTagInput.value.length>0){this._createTag(this.newTagInput.value,true,Q)}else{this.form._submitInvoked(Q)}},this,true);M.on("click",function(Q){D.stopEvent(Q);this.inputBox.value="";this.doHide(true)},this,true);this.inputBox=this.newTagInput;this.keyListener=new m(this.inputBox,{keys:[m.KEY.ESCAPE]},{fn:function(R,Q){D.stopEvent(Q[1]);this.inputBox.value="";this.doHide(true)},scope:this,correctScope:true});this.balloon=Alfresco.util.createBalloon(K);this.balloon.onClose.subscribe(function(Q){try{if(!this.suppressInputBoxFocus){this.inputBox.focus()}}catch(Q){}},this,true);var L=this.params.validations;for(var H=0,O=L.length;H<O;H++){this.form.addValidation(this.inputBox,L[H].type,L[H].args,L[H].when,L[H].message)}var P=this;this.form.addError=function G(R,Q){P.balloon.html(R);P.balloon.show()};this.form.init();this.markupGenerated=true},_createTag:function q(I,H,G){var F={name:I},E={fn:function(K){this._applyTag(I,K.json.nodeRef);if(YUIDom.isAncestor(this.currentTags,this)){YUIDom.insertAfter(this.parentNode,this.currentTags)}if(H){this.form._submitInvoked(G)}},scope:this},J={fn:function(K){},scope:this};Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.PROXY_URI+"api/tag/workspace/SpacesStore",dataObj:F,successCallback:E,failureCallback:J})}})})();Alfresco.util.findEventClass=function(c,a){var d=c.element;var b=(a||"span").toLowerCase();while((d!==null)&&((d.tagName.toLowerCase()!=b)||(d.className.indexOf("yui")===0))){d=d.firstChild}if(d===null){return null}return d.className};Alfresco.util.hasEventInterest=function(d,a){var f=a[1],c="source",e="target",b=false;if(f){if(f.action==="navigate"){f.eventGroup=f.anchor.rel}if(f.eventGroup&&d){c=(typeof f.eventGroup=="string")?f.eventGroup:f.eventGroup.eventGroup;e=(typeof d=="string")?d:d.eventGroup;b=(c==e)}}return b};Alfresco.util.hasRequiredFlashPlayer=function(c,b,a){if(typeof DetectFlashVer=="function"){return DetectFlashVer(c,b,a)}return false};Alfresco.util.addMessages=function(b,a){if(a===undefined){throw new Error("messageScope must be defined")}else{if(a=="global"){throw new Error("messageScope cannot be 'global'")}else{Alfresco.messages.scope[a]=YAHOO.lang.merge(Alfresco.messages.scope[a]||{},b);return true}}return false};Alfresco.util.copyMessages=function(b,a){if(b===undefined){throw new Error("Source must be defined")}else{if(Alfresco.messages.scope[b]===undefined){throw new Error("Source namespace doesn't exist")}else{if(a===undefined){throw new Error("Destination must be defined")}else{if(a=="global"){throw new Error("Destination cannot be 'global'")}else{Alfresco.messages.scope[a]=YAHOO.lang.merge({},Alfresco.messages.scope[b])}}}}};Alfresco.util.message=function(a,b){var f=a;if(typeof a!="string"){throw new Error("Missing or invalid argument: messageId")}var d=Alfresco.messages.global[a];if(typeof d=="string"){f=d}if((typeof b=="string")&&(typeof Alfresco.messages.scope[b]=="object")){var c=Alfresco.messages.scope[b][a];if(typeof c=="string"){f=c}}var e=[];if((arguments.length==3)&&(typeof arguments[2]=="object")){e=arguments[2]}else{e=Array.prototype.slice.call(arguments).slice(2)}if(YAHOO.lang.isArray(e)&&e.length>0){f=f.replace(/''/g,"'")}f=YAHOO.lang.substitute(f,e);return f};Alfresco.util.calI18nParams=function(b){var a=Alfresco.util.message;b.cfg.setProperty("MONTHS_SHORT",a("months.short").split(","));b.cfg.setProperty("MONTHS_LONG",a("months.long").split(","));b.cfg.setProperty("WEEKDAYS_1CHAR",a("days.initial").split(","));b.cfg.setProperty("WEEKDAYS_SHORT",a("days.short").split(","));b.cfg.setProperty("WEEKDAYS_MEDIUM",a("days.medium").split(","));b.cfg.setProperty("WEEKDAYS_LONG",a("days.long").split(","));b.cfg.setProperty("START_WEEKDAY",a("calendar.widget_config.start_weekday"));var c=a("calendar.widget_config.my_label_month_position");if(c.length!==0){b.cfg.setProperty("MY_LABEL_MONTH_POSITION",parseInt(c))}var e=a("calendar.widget_config.my_label_month_suffix");if(e.length!==0){b.cfg.setProperty("MY_LABEL_MONTH_SUFFIX",e)}var d=a("calendar.widget_config.my_label_year_position");if(d.length!==0){b.cfg.setProperty("MY_LABEL_YEAR_POSITION",parseInt(d))}b.cfg.setProperty("MY_LABEL_YEAR_SUFFIX",a("calendar.widget_config.my_label_year_suffix"))};Alfresco.util.caretFix=function(c){if(YAHOO.env.ua.gecko===1.8){if(typeof c=="string"){c=YUIDom.get(c)}var b=YUISelector.query(".yui-u",c);for(var a=0;a<b.length;a++){var d=b[a];YUIDom.addClass(d,"caret-fix")}}};Alfresco.util.undoCaretFix=function(c){if(YAHOO.env.ua.gecko===1.8){if(typeof c=="string"){c=YUIDom.get(c)}var b=YUISelector.query(".caret-fix",c);for(var a=0;a<b.length;a++){var d=b[a];YUIDom.removeClass(d,"caret-fix")}}};Alfresco.util.submitForm=function(d){var b=YAHOO.env.ua;var a=false;if(d!==null){if(b.ie&&(b.ie<9)){a=d.fireEvent("onsubmit")}else{var c=document.createEvent("HTMLEvents");c.initEvent("submit",true,true);a=d.dispatchEvent(c)}if((b.ie||b.webkit)&&a){d.submit()}}};Alfresco.util.parseJSON=function(b,a){try{return YAHOO.lang.JSON.parse(b)}catch(c){if(a){Alfresco.util.PopupManager.displayPrompt({title:"Failure",text:"Can't parse response as json: '"+b+"'"})}}return null};Alfresco.util.uriTemplate=function(a,b,c){if(!(a in Alfresco.constants.URI_TEMPLATES)){return null}return Alfresco.util.renderUriTemplate(Alfresco.constants.URI_TEMPLATES[a],b,c)};Alfresco.util.renderUriTemplate=function(b,d,e){if(b.indexOf("{site}")!==-1){if(d.hasOwnProperty("site")){if(!Alfresco.util.isValueSet(d.site)){b=b.replace("/site/{site}","")}}else{if(Alfresco.constants.SITE.length>0){d.site=Alfresco.constants.SITE}else{b=b.replace("/site/{site}","")}}}var c=b,a=/^(http|https):\/\//;while(c!==(c=YAHOO.lang.substitute(c,d))){}if(!a.test(c)){c=Alfresco.util.combinePaths(Alfresco.constants.URL_PAGECONTEXT,c)}if(Alfresco.constants.PORTLET){if(c.indexOf(Alfresco.constants.URL_CONTEXT)===0){c=Alfresco.util.combinePaths("/",c.substring(Alfresco.constants.URL_CONTEXT.length))}c=Alfresco.constants.PORTLET_URL.replace("$$scriptUrl$$",encodeURIComponent(decodeURIComponent(c.replace(/%25/g,"%2525").replace(/%26/g,"%252526"))))}if(e&&(c.indexOf(location.protocol+"//")!==0)){if(c.substring(0,1)!=="/"){c="/"+c}c=location.protocol+"//"+location.host+c}return c};Alfresco.util.siteURL=function(a,b,c){return Alfresco.util.uriTemplate("sitepage",YAHOO.lang.merge(b||{},{pageid:a}),c)};Alfresco.util.parseURL=function(c){var b=document.createElement("a");b.href=c;var d={protocol:b.protocol,hostname:b.hostname,port:b.port,host:b.host,pathname:b.pathname,search:b.search,hash:b.hash,url:c,queryParams:Alfresco.util.getQueryStringParameters(c),getUrl:function(){return this.getDomain()+this.pathname+Alfresco.util.toQueryString(this.queryParams)+this.hash},getDomain:function(){return this.protocol+"//"+this.host}};return d};Alfresco.util.navigateTo=function(e,f,d){f=f?f.toUpperCase():"GET";if(f=="GET"){window.location.href=e}else{var c=document.createElement("form");c.method=f;c.action=e;if(f=="POST"||f=="PUT"){var a;for(var b in d){if(d.hasOwnProperty(b)){value=d[b];if(value){a=document.createElement("input");a.setAttribute("name",b);a.setAttribute("type","hidden");a.value=value;c.appendChild(a)}}}}document.body.appendChild(c);c.submit()}};Alfresco.util.siteDashboardLink=function(g,b,f,d){if(!YAHOO.lang.isString(g)||g.length===0){return""}var a=Alfresco.util.encodeHTML(YAHOO.lang.isString(b)&&b.length>0?b:g),c=Alfresco.constants.URI_TEMPLATES.sitedashboardpage,e="";if(d||YAHOO.lang.isUndefined(c)||c.length===0||Alfresco.constants.PORTLET){return"<span>"+a+"</span>"}e=Alfresco.util.uriTemplate("sitedashboardpage",{site:g});return'<a href="'+e+'" '+(f||"")+">"+a+"</a>"};Alfresco.util.userProfileLink=function(f,g,e,c){if(!YAHOO.lang.isString(f)||f.length===0){return""}var a=Alfresco.util.encodeHTML(YAHOO.lang.isString(g)&&g.length>0?g:f),b=Alfresco.constants.URI_TEMPLATES.userprofilepage,d="";if(c||YAHOO.lang.isUndefined(b)||b.length===0||Alfresco.constants.PORTLET){return"<span>"+a+"</span>"}d=Alfresco.util.uriTemplate("userprofilepage",{userid:f});return'<a href="'+d+'" '+(e||"")+">"+a+"</a>"};Alfresco.util.contentURL=function(c,b,a){return Alfresco.constants.PROXY_URI+"api/node/content/"+c.replace(":/","")+"/"+b+(a?"?a=true":"")};Alfresco.util.getQueryStringParameter=function(b,a){var c=this.getQueryStringParameters(a);if(b in c){return c[b]}return null};Alfresco.util.getQueryStringParameters=function(b){var e,g,l,a,d,h,c,k,f;b=b||window.location.href;l=b.indexOf("?");a=l>=0?b.substr(l+1):b;l=a.lastIndexOf("#");a=l>=0?a.substr(0,l):a;d=a.split("&");f={};for(e=0,g=d.length;e<g;e++){h=d[e].split("=");if(h.length>=2){c=h[0];k=decodeURIComponent(h[1]);switch(typeof f[c]){case"undefined":f[c]=k;break;case"string":f[c]=[f[c]].concat(k);break;case"object":f[c]=f[c].concat(k);break}}}return f};Alfresco.util.toQueryString=function(c){var a="?",b,d,e;for(b in c){if(c.hasOwnProperty(b)){d=c[b];if(typeof d=="object"){for(e in d){if(d.hasOwnProperty(e)){a+=encodeURIComponent(b)+"="+encodeURIComponent(d[e])+"&"}}}else{if(typeof d=="string"){a+=encodeURIComponent(b)+"="+encodeURIComponent(d)+"&"}}}}return a.substring(0,a.length-1)};Alfresco.util.getVar=function(b,a){var d=typeof a!="undefined"?a:null;try{if(window.name!==""&&YAHOO.lang.JSON.isValid(window.name)){var g=YAHOO.lang.JSON.parse(window.name),c=g[location.host],f=null;if(typeof c=="object"){f=c[b];if(typeof f!=="undefined"&&f!==null){d=f}}}}catch(h){Alfresco.logger.error("Alfresco.util.getVar()",b,a,h)}return d};Alfresco.util.setVar=function(a,f){var d=true;try{var b={};if(window.name!==""&&YAHOO.lang.JSON.isValid(window.name)){b=YAHOO.lang.JSON.parse(window.name)}if(typeof b[location.host]=="undefined"){b[location.host]={}}b[location.host][a]=f;window.name=YAHOO.lang.JSON.stringify(b)}catch(c){Alfresco.logger.error("Alfresco.util.setVar()",a,f,c);d=false}return d};Alfresco.util.getTags=function(f){var c=null,b=[],e={},d=new RegExp(/([^"^\s]+)\s*|"([^"]+)"\s*/g),a;while(c=d.exec(f)){a=c[1]||c[2];if(e[a]===undefined){e[a]=true;b.push(a)}}return b};Alfresco.util.cleanBubblingObject=function(b){var d={action:true,flagged:true,decrepitate:true,stop:true},c={};for(var a in b){if(b.hasOwnProperty(a)&&d[a]!==true){c[a]=b[a]}}return c};Alfresco.util.bind=function(c,b){if(!YAHOO.lang.isObject(b)){return c}var a=Array.prototype.slice.call(arguments).slice(2);return(function(){return c.apply(b,a.concat(Array.prototype.slice.call(arguments)))})};Alfresco.util.isAutocompleteIgnoreKey=function(a){if((a==9)||(a==13)||(a==16)||(a==17)||(a>=18&&a<=20)||(a==27)||(a>=33&&a<=35)||(a>=36&&a<=40)||(a>=44&&a<=45)||(a==229)){return true}return false};Alfresco.util.YUILoaderHelper=function(){var f=null;var h=[];var e=false;var g=function d(){if(f===null){f=new YAHOO.util.YUILoader({base:Alfresco.constants.URL_RESCONTEXT+"yui/",filter:Alfresco.constants.DEBUG?"DEBUG":"",loadOptional:false,skin:{},onSuccess:Alfresco.util.YUILoaderHelper.onLoaderComplete,onFailure:function(k){alert("load failed:"+k)},scope:this});f.addModule({name:"swfplayer",type:"js",path:"swfplayer/swfplayer.js",varName:"SWFPlayer",requires:["uploader"]});f.addModule({name:"columnbrowser",type:"js",path:"columnbrowser/columnbrowser.js",varName:"ColumnBrowser",requires:["json","carousel","paginator"],skinnable:true})}};return({require:function c(m,k,o){g();if(m.length>0){var n=true;for(var l=0;l<m.length;l++){if(YAHOO.env.getVersion(m[l])===null){n=false;break}}if(n&&(k!==null)){YAHOO.lang.later(10,o,k)}else{f.require(m);h.push({required:Alfresco.util.arrayToObject(m),fn:k,scope:(typeof o!="undefined"?o:window)})}}else{if(k!==null){k.call(typeof o!="undefined"?o:window)}}},loadComponents:function a(k){g();if(e||k===true){if(f!==null){f.insert(null,"js")}}},onLoaderComplete:function b(){for(var k=0;k<h.length;k++){if(h[k].fn){h[k].fn.call(h[k].scope)}}h=[];e=true}})}();Alfresco.util.ComponentManager=function(){var e=[];return({register:function d(l){if(l.id!=="null"&&e.hasOwnProperty(l.id)){var k=e[l.id];if(k.name===l.name){if(typeof k.destroy==="function"){k.destroy()}this.unregister(e[l.id])}}e.push(l);e[l.id]=l},unregister:function h(k){for(var l=0;l<e.length;l++){if(e[l]==k){e.splice(l,1);delete e[k.id];break}}},reregister:function c(k){this.unregister(k);this.register(k)},find:function g(q){var p=[];var k,m;for(var o=0,l=e.length;o<l;o++){m=e[o];k=true;for(var n in q){if(q[n]!=m[n]){k=false}}if(k){p.push(m)}}return p},findFirst:function b(k){var l=Alfresco.util.ComponentManager.find({name:k});return(typeof l[0]=="object"?l[0]:null)},get:function a(k){return(e[k]||null)},list:function f(){return e}})}();Alfresco.util.PopupManager=function(){var b=Alfresco.util.encodeHTML;return({zIndex:15,defaultDisplayMessageConfig:{title:null,text:null,spanClass:"message",displayTime:2.5,effect:YAHOO.widget.ContainerEffect.FADE,effectDuration:0.5,visible:false,noEscape:false},displayMessage:function g(h,l){var l=l||document.body;var o=YAHOO.lang.merge(this.defaultDisplayMessageConfig,h);if(o.text===undefined){throw new Error("Property text in userConfig must be set")}var k={modal:false,visible:o.visible,close:false,draggable:false,effect:{effect:o.effect,duration:o.effectDuration},zIndex:this.zIndex++};if(o.effect===null||YAHOO.env.ua.ie>0){delete k.effect}var m=new YAHOO.widget.Dialog("message",k);var n="<span class='"+o.spanClass+"'>"+(o.noEscape?o.text:b(o.text))+"</span>";m.setBody(n);m.render(l);m.center();if(o.displayTime>0){m.subscribe("show",this._delayPopupHide,{popup:m,displayTime:(o.displayTime*1000)},true)}m.show();return m},_delayPopupHide:function c(){YAHOO.lang.later(this.displayTime,this,function(){this.popup.destroy()})},defaultDisplayPromptConfig:{title:null,text:null,icon:null,close:false,constraintoviewport:true,draggable:true,effect:null,effectDuration:0.5,modal:true,visible:false,noEscape:false,buttons:[{text:null,handler:function(){this.destroy()},isDefault:true}]},displayPrompt:function f(k,l){var l=l||document.body;if(this.defaultDisplayPromptConfig.buttons[0].text===null){this.defaultDisplayPromptConfig.buttons[0].text=Alfresco.util.message("button.ok",this.name)}var m=YAHOO.lang.merge(this.defaultDisplayPromptConfig,k);if(m.text===undefined){throw new Error("Property text in userConfig must be set")}var h=new YAHOO.widget.SimpleDialog("prompt",{close:m.close,constraintoviewport:m.constraintoviewport,draggable:m.draggable,effect:m.effect,modal:m.modal,visible:m.visible,zIndex:this.zIndex++});if(m.title){h.setHeader(b(m.title))}h.setBody(m.noEscape?m.text:b(m.text));if(m.icon){h.cfg.setProperty("icon",m.icon)}if(m.buttons){h.cfg.queueProperty("buttons",m.buttons)}h.render(l);h.center();h.show()},defaultGetUserInputConfig:{title:null,text:null,input:"textarea",value:"",icon:null,close:true,constraintoviewport:true,draggable:true,effect:null,effectDuration:0.5,modal:true,visible:false,initialShow:true,noEscape:true,html:null,callback:null,buttons:[{text:null,handler:null,isDefault:true},{text:null,handler:function(){this.destroy()}}]},getUserInput:function e(l){if(this.defaultGetUserInputConfig.buttons[0].text===null){this.defaultGetUserInputConfig.buttons[0].text=Alfresco.util.message("button.ok",this.name)}if(this.defaultGetUserInputConfig.buttons[1].text===null){this.defaultGetUserInputConfig.buttons[1].text=Alfresco.util.message("button.cancel",this.name)}var p=YAHOO.lang.merge(this.defaultGetUserInputConfig,l);var h=new YAHOO.widget.SimpleDialog("userInput",{close:p.close,constraintoviewport:p.constraintoviewport,draggable:p.draggable,effect:p.effect,modal:p.modal,visible:p.visible,zIndex:this.zIndex++});if(p.title){h.setHeader(b(p.title))}var m=p.html,o=Alfresco.util.generateDomId();if(m===null){m="";if(p.text){m+='<label for="'+o+'">'+(p.noEscape?p.text:b(p.text))+"</label><br/>"}if(p.input=="textarea"){m+='<textarea id="'+o+'" tabindex="0">'+p.value+"</textarea>"}else{if(p.input=="text"){m+='<input id="'+o+'" tabindex="0" type="text" value="'+p.value+'"/>'}}}h.setBody(m);if(p.icon){h.cfg.setProperty("icon",p.icon)}if(p.buttons){if(p.okButtonText){p.buttons[0].text=p.okButtonText}if(typeof l.buttons=="undefined"||typeof l.buttons[0]=="undefined"){p.buttons[0].handler={fn:function(q,t){var r=null;if(YUIDom.get(t.id)){var s=YUIDom.get(t.id);r=YAHOO.lang.trim(s.value||s.text)}this.destroy();if(t.callback.fn){t.callback.fn.call(t.callback.scope||window,r,t.callback.obj)}},obj:{id:o,callback:p.callback}}}h.cfg.queueProperty("buttons",p.buttons)}h.render(document.body);if(h.getButtons().length>0){var n=h.getButtons()[0];YAHOO.util.Event.addListener(o,"keyup",function(q,r){r.set("disabled",YAHOO.lang.trim(this.value||this.text||"").length==0)},n);n.set("disabled",YAHOO.lang.trim(p.value).length==0)}h.center();if(p.initialShow){h.show()}if(p.value!==""){YUIDom.get(o).selectionStart=0;YUIDom.get(o).selectionEnd=p.value.length}var k=new YAHOO.util.KeyListener(document,{keys:YAHOO.util.KeyListener.KEY.ESCAPE},{fn:function(r,q){this.destroy()},scope:h,correctScope:true});k.enable();if(YUIDom.get(o)){YUIDom.get(o).focus()}return h},displayForm:function d(k){var n=k.properties.htmlid||Alfresco.util.generateDomId();k.properties.htmlid=n;var h=this.displayWebscript({title:k.title,url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",properties:YAHOO.lang.merge({submitType:"json",showCaption:false,formUI:true,showCancelButton:true},k.properties)});YAHOO.Bubbling.on("formContentReady",function m(q,o){if(Alfresco.util.hasEventInterest(n+"-form",o)){var p=o[1].buttons.submit;p.set("label",Alfresco.util.message("label.ok"));var r=o[1].buttons.cancel;if(r){r.addListener("click",this.panel.destroy,this.panel,true)}}},{panel:h,config:k});YAHOO.Bubbling.on("beforeFormRuntimeInit",function l(p,o){if(Alfresco.util.hasEventInterest(n+"-form",o)){o[1].runtime.setAJAXSubmit(true,{successCallback:{fn:function q(r){this.panel.destroy();if(this.config.success&&YAHOO.lang.isFunction(this.config.success.fn)){this.config.success.fn.call(this.config.success.scope||{},r,this.config.success.obj)}},scope:this},successMessage:this.config.successMessage,failureCallback:this.config.success,failureMessage:this.config.failureMessage})}},{panel:h,config:k})},displayWebscript:function a(k){k.properties.htmlid=k.properties.htmlid||Alfresco.util.generateDomId();var l=new YAHOO.widget.Dialog(k.properties.htmlid+"-panel",{visible:false,modal:true,constraintoviewport:true,fixedcenter:"contained",postmethod:"none"});Alfresco.util.Ajax.request({method:k.method||Alfresco.util.Ajax.GET,url:k.url,dataObj:k.properties,successCallback:{fn:function h(m,n){l.setHeader(n.title);l.setBody(m.serverResponse.responseText);l.render(document.body);l.show()},scope:this,obj:k},failureMessage:Alfresco.util.message("message.failure"),scope:this,execScripts:true});return l}})}();Alfresco.util.FilterManager=function(){var b=[];return({register:function a(e,h){var f,g,d;if(typeof h=="string"){h=[h]}for(f=0,g=h.length;f<g;f++){d=h[f];b.push({filterOwner:e,filterId:d});b[d]=e}},getOwner:function c(d){return(b[d]||null)}})}();Alfresco.util.Ajax=function(){return{FORM:"application/x-www-form-urlencoded",JSON:"application/json",GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",defaultRequestConfig:{method:"GET",url:null,dataObj:null,dataStr:null,dataForm:null,requestContentType:null,responseContentType:null,successCallback:null,successMessage:null,failureCallback:null,failureMessage:null,execScripts:false,noReloadOnAuthFailure:false,object:null},request:function(b){var e=YAHOO.lang.merge(this.defaultRequestConfig,b);Alfresco.util.assertNotEmpty(e.url,"Parameter 'url' can NOT be null");Alfresco.util.assertNotEmpty(e.method,"Parameter 'method' can NOT be null");if(e.requestContentType){YAHOO.util.Connect.setDefaultPostHeader(e.requestContentType);YAHOO.util.Connect.setDefaultXhrHeader(e.requestContentType);YAHOO.util.Connect.initHeader("Content-Type",e.requestContentType)}else{YAHOO.util.Connect.setDefaultPostHeader(this.FORM);YAHOO.util.Connect.setDefaultXhrHeader(this.FORM);YAHOO.util.Connect.initHeader("Content-Type",this.FORM)}if(e.requestContentType===this.JSON){if(e.method.toUpperCase()===this.GET){if(e.dataObj){e.url+=(e.url.indexOf("?")==-1?"?":"&")+this.jsonToParamString(e.dataObj,true)}}else{e.dataStr=YAHOO.lang.JSON.stringify(e.dataObj||{})}}else{if(e.dataObj){if(e.method.toUpperCase()===this.GET){e.url+=(e.url.indexOf("?")==-1?"?":"&")+this.jsonToParamString(e.dataObj,true)}else{e.dataStr=this.jsonToParamString(e.dataObj,true)}}}if(e.dataForm!==null){YAHOO.util.Connect.setForm(e.dataForm)}var d={success:this._successHandler,failure:this._failureHandler,scope:this,argument:{config:b}};if(YAHOO.env.ua.air!==0){if(e.method.toUpperCase()=="PUT"||e.method.toUpperCase()=="DELETE"){var a=Alfresco.util.getQueryStringParameter("alf_method",e.url);if(a===null){e.url+=(e.url.indexOf("?")==-1?"?":"&")+"alf_method="+e.method;e.method=this.POST}}}YAHOO.util.Connect.asyncRequest(e.method,e.url,d,e.dataStr)},jsonRequest:function(a){a.requestContentType=this.JSON;a.responseContentType=this.JSON;this.request(a)},jsonGet:function(a){a.method=this.GET;this.jsonRequest(a)},jsonPost:function(a){a.method=this.POST;this.jsonRequest(a)},jsonPut:function(a){a.method=this.PUT;this.jsonRequest(a)},jsonDelete:function(a){a.method=this.DELETE;this.jsonRequest(a)},jsonToParamString:function(c,b){var e="",d=true,a;for(a in c){if(c.hasOwnProperty(a)){if(d){d=false}else{e+="&"}if(b){e+=encodeURIComponent(a)+"="+encodeURIComponent(c[a])}else{e+=a+"="+c[a]}}}return e},_successHandler:function(d){var c=d.argument.config;if(c.execScripts){var b=this.sanitizeMarkup(d.responseText);d.responseText=b[0];var a=b[1];if(YAHOO.lang.trim(a).length>0){window.setTimeout(a,0);YAHOO.lang.later(0,this,this._successHandlerPostExec,d)}else{this._successHandlerPostExec(d)}}else{this._successHandlerPostExec(d)}},sanitizeMarkup:function(c){var a=[];var b=null;var d=/<script[^>]*>([\s\S]*?)<\/script>/gi;while((b=d.exec(c))){a.push(b[1])}a=a.join("\n");return[c.replace(d,""),a]},_successHandlerPostExec:function(e){var a=e.argument.config;if(a.execScripts){Alfresco.util.YUILoaderHelper.loadComponents()}var d=a.successCallback;if(d&&typeof d.fn=="function"){var c=e.getResponseHeader["Content-Type"]||e.getResponseHeader["content-type"]||a.responseContentType;var b=null;if(/^\s*application\/json/.test(c)){b=Alfresco.util.parseJSON(e.responseText)}d.fn.call((typeof d.scope=="object"?d.scope:this),{config:a,json:b,serverResponse:e},d.obj)}if(a.successMessage){Alfresco.util.PopupManager.displayMessage({text:a.successMessage})}},_failureHandler:function(f){var b=f.argument.config;var e=f.getResponseHeader["Content-Type"]||f.getResponseHeader["content-type"]||b.responseContentType;if((f.status==401||(f.status==302&&(/(text\/html)/).test(e)))&&!b.noReloadOnAuthFailure){window.location.reload(true);return}var d=b.failureCallback,c=null;if((d&&typeof d.fn=="function")||(b.failureMessage)){if(d&&typeof d.fn=="function"){var a=true;if(b.failureMessage||b.failureCallback){a=false}if(b.responseContentType==="application/json"){c=Alfresco.util.parseJSON(f.responseText,a)}d.fn.call((typeof d.scope=="object"?d.scope:this),{config:b,json:c,serverResponse:f},d.obj)}if(b.failureMessage){Alfresco.util.PopupManager.displayPrompt({title:Alfresco.util.message("message.failure",this.name),text:b.failureMessage})}}else{if(b.responseContentType=="application/json"){c=Alfresco.util.parseJSON(f.responseText);Alfresco.util.PopupManager.displayPrompt({title:c.status.name,text:c.message})}else{if(f.statusText){Alfresco.util.PopupManager.displayPrompt({title:Alfresco.util.message("message.failure",this.name),text:f.statusText})}else{Alfresco.util.PopupManager.displayPrompt({title:Alfresco.util.message("message.failure",this.name),text:"Error sending data to server."})}}}}}}();Alfresco.util.Cursor=function(){return({DRAGGABLE:"dnd-draggable",DRAG:"dnd-drag",DROP_VALID:"dnd-dropValid",DROP_INVALID:"dnd-dropInvalid",setCursorState:function(e,b){var a=[this.DRAGGABLE,this.DRAG,this.DROP_VALID,this.DROP_INVALID];for(var c=0;c<a.length;c++){var d=a[c];if(d===b){YUIDom.addClass(e,b)}else{YUIDom.removeClass(e,d)}}}})}();Alfresco.util.Anim=function(){return({fadeAttributes:{adjustDisplay:true,callback:null,scope:this,period:0.5},fadeIn:function b(f,e){return this._fade(f,true,e)},fadeOut:function a(f,e){return this._fade(f,false,e)},_fade:function d(g,l,k){g=YUIDom.get(g);k=YAHOO.lang.merge(this.fadeAttributes,k?k:{});var e=k.adjustDisplay;var m=YAHOO.env.ua.ie===0;if(m){YUIDom.setStyle(g,"opacity",l?0:1)}if(m){YUIDom.setStyle(g,"visibility","visible")}else{YUIDom.setStyle(g,"visibility",l?"visible":"hidden")}if(e&&YUIDom.getStyle(g,"display")==="none"){YUIDom.setStyle(g,"display","block")}var n=k.callback,o=k.scope,f=g;if(m){var h=new YAHOO.util.Anim(g,{opacity:{to:l?1:0}},k.period);h.onComplete.subscribe(function(p){if(!l&&e){YUIDom.setStyle(f,"display","none")}if(n){n.call(o?o:this)}});h.animate()}else{if(!l&&e){YUIDom.setStyle(f,"display","none")}if(n){n.call(o?o:this)}}},pulseAttributes:{callback:null,inColor:"#ffff80",inDuration:0.2,outDuration:1.2,clearOnComplete:true},pulse:function c(h,n){if(!YAHOO.util.ColorAnim){return}var k=YUIDom.get(h);if(k){var f=YAHOO.lang.merge(this.pulseAttributes,{outColor:YUIDom.getStyle(k,"backgroundColor")});if(typeof n=="object"){f=YAHOO.lang.merge(f,n)}var g=new YAHOO.util.ColorAnim(k,{backgroundColor:{to:f.inColor}},f.inDuration);var l=new YAHOO.util.ColorAnim(k,{backgroundColor:{to:f.outColor}},f.outDuration);g.onComplete.subscribe(function m(){l.animate()});l.onComplete.subscribe(function e(){if(f.clearOnComplete){YUIDom.setStyle(k,"backgroundColor","")}if(f.callback&&(typeof f.callback.fn=="function")){f.callback.fn.call(f.callback.scope||this,f.callback.obj)}});g.animate()}}})}();(function(){Alfresco.util.NodeRef=function(b){try{var c=b.replace(":/",""),a=c.split("/");return({nodeRef:b,storeType:a[0],storeId:a[1],id:a[2],uri:c,toString:function(){return b}})}catch(d){d.message="Invalid nodeRef: "+b;throw d}}})();Alfresco.constants=YAHOO.lang.merge(Alfresco.constants||{},{PROP_NAME:"cm:name",PROP_TITLE:"cm:title",PROP_DESCRIPTION:"cm:description",PROP_CREATED:"cm:created",PROP_CREATOR:"cm:creator",PROP_MODIFIER:"cm:modifier",PROP_MODIFIED:"cm:modified",PROP_CATEGORIES:"cm:categories",PROP_TAGGABLE:"cm:taggable",PROP_GOOGLEDOC_URL:"gd:url"});(function(){Alfresco.util.Node=function(f){if(YAHOO.lang.isUndefined(f)||f==null){return null}var e=YAHOO.lang.isString(f)?YAHOO.lang.JSON.parse(f):f,c=YAHOO.lang.isString(f)?f:YAHOO.lang.JSON.stringify(f);var o=new Alfresco.util.NodeRef(e.nodeRef),l=e.properties||{},p=e.aspects||[],k=e.permissions||{},b=null,g=null,d=null,m=null;categoriesObj=null;for(var h in l){if(l.hasOwnProperty(h)){if(h.indexOf("cm:")===0){l[h.substring(3)]=l[h]}l[h.replace(/:/g,"_")]=l[h]}}var r=function n(){if(g===null){g=[];var u=e.properties[Alfresco.constants.PROP_TAGGABLE]||[];for(var s=0,t=u.length;s<t;s++){g.push(u[s].name)}}return g};var q=function a(){if(m===null){m=[];var s=e.properties[Alfresco.constants.PROP_CATEGORIES]||[];for(var t=0,u=s.length;t<u;t++){m.push([s[t].name,s[t].path])}}return m};return({getNode:function(){return e},toJSON:function(){return YAHOO.lang.JSON.stringify(e)},setNodeRef:function(s){this.nodeRef=new Alfresco.util.NodeRef(s)},nodeRef:o,type:e.type,isContainer:e.isContainer,isLink:e.isLink,isLocked:e.isLocked,linkedNode:new Alfresco.util.Node(e.linkedNode),contentURL:e.contentURL,mimetype:e.mimetype,size:e.size,properties:l,aspects:p,hasAspect:function(s){if(b===null){b=Alfresco.util.arrayToObject(this.aspects)}return b.hasOwnProperty(s)},permissions:k,hasPermission:function(s){return k.user[s]},tags:r(),hasTag:function(s){if(d===null){d=Alfresco.util.arrayToObject(this.tags)}return d.hasOwnProperty(s)},categories:q()})}})();(function(){Alfresco.util.Deferred=function(h,a){var e=false;var f=a;var d={};if(YAHOO.lang.isArray(h)){d=Alfresco.util.arrayToObject(h,false)}else{YAHOO.lang.augmentObject(d,h,true)}var k=function c(){for(var l in d){if(d.hasOwnProperty(l)){if(d[l]!==true){return}}}if(YAHOO.lang.isFunction(f.fn)){e=true;f.fn.call(f.scope||window,f.obj)}};return({fulfil:function g(l){if(!e&&d.hasOwnProperty(l)){d[l]=true;k();return true}return false},expire:function b(){e=true}})}})();if(typeof log4javascript!="undefined"){Alfresco.logger=log4javascript.getDefaultLogger();if(Alfresco.constants.AUTOLOGGING||Alfresco.util.getQueryStringParameter("log")=="on"){Alfresco.logger.info("Alfresco LOGGING enabled.")}else{if(Alfresco.util.getVar("logging",false)){Alfresco.logger.info("Alfresco LOGGING re-enabled.")}else{log4javascript.setEnabled(false)}}Alfresco.logger.getEffectiveAppenders()[0].addEventListener("unload",function(){log4javascript.setEnabled(false);Alfresco.util.setVar("logging",false)});if(window.addEventListener){var sequence=[],logSequence=[17,17,16,16],logSequenceLen=logSequence.length,logSequenceStr=logSequence.toString();document.addEventListener("keydown",function(a){sequence.push(a.keyCode);while(sequence.length>logSequenceLen){sequence.shift()}if(sequence.toString().indexOf(logSequenceStr)>=0){sequence=[];if(log4javascript.isEnabled()){log4javascript.setEnabled(false);Alfresco.logger.getEffectiveAppenders()[0].hide();Alfresco.util.setVar("logging",false)}else{log4javascript.setEnabled(true);Alfresco.logger.getEffectiveAppenders()[0].show();Alfresco.util.setVar("logging",true)}}},true)}}else{Alfresco.logger={trace:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},fatal:function(){},isDebugEnabled:function(){return false}}}Alfresco.thirdparty.dateFormat=function(){var a=function(){var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,e=/[^-+\dA-Z]/g,d=function(g,f){g=String(g);f=parseInt(f,10)||2;while(g.length<f){g="0"+g}return g};return function(k,v){if(arguments.length==1&&(typeof k=="string"||k instanceof String)&&!/\d/.test(k)){v=k;k=undefined}if(typeof k=="string"){k=k.replace(".","")}k=k?new Date(k):new Date();if(isNaN(k)){throw"invalid date"}v=String(this.masks[v]||v||this.masks["default"]);var p=k.getDate(),f=k.getDay(),l=k.getMonth(),r=k.getFullYear(),t=k.getHours(),n=k.getMinutes(),u=k.getSeconds(),q=k.getMilliseconds(),g=k.getTimezoneOffset(),h={d:p,dd:d(p),ddd:this.i18n.dayNames[f],dddd:this.i18n.dayNames[f+7],m:l+1,mm:d(l+1),mmm:this.i18n.monthNames[l],mmmm:this.i18n.monthNames[l+12],yy:String(r).slice(2),yyyy:r,h:t%12||12,hh:d(t%12||12),H:t,HH:d(t),M:n,MM:d(n),s:u,ss:d(u),l:d(q,3),L:d(q>99?Math.round(q/10):q),t:t<12?this.TIME_AM.charAt(0):this.TIME_PM.charAt(0),tt:t<12?this.TIME_AM:this.TIME_PM,T:t<12?this.TIME_AM.charAt(0).toUpperCase():this.TIME_PM.charAt(0).toUpperCase(),TT:t<12?this.TIME_AM.toUpperCase():this.TIME_PM.toUpperCase(),Z:(String(k).match(c)||[""]).pop().replace(e,""),o:(g>0?"-":"+")+d(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4)};return v.replace(b,function(m){return(m in h)?h[m]:m.slice(1,m.length-1)})}}();return a.apply(arguments.callee,arguments)};Alfresco.thirdparty.dateFormat.DAY_NAMES=(Alfresco.util.message("days.medium")+","+Alfresco.util.message("days.long")).split(",");Alfresco.thirdparty.dateFormat.MONTH_NAMES=(Alfresco.util.message("months.short")+","+Alfresco.util.message("months.long")).split(",");Alfresco.thirdparty.dateFormat.TIME_AM=Alfresco.util.message("date-format.am");Alfresco.thirdparty.dateFormat.TIME_PM=Alfresco.util.message("date-format.pm");Alfresco.thirdparty.dateFormat.masks={"default":Alfresco.util.message("date-format.default"),defaultDateOnly:Alfresco.util.message("date-format.defaultDateOnly"),shortDate:Alfresco.util.message("date-format.shortDate"),mediumDate:Alfresco.util.message("date-format.mediumDate"),longDate:Alfresco.util.message("date-format.longDate"),fullDate:Alfresco.util.message("date-format.fullDate"),shortTime:Alfresco.util.message("date-format.shortTime"),mediumTime:Alfresco.util.message("date-format.mediumTime"),longTime:Alfresco.util.message("date-format.longTime"),isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoFullDateTime:"yyyy-mm-dd'T'HH:MM:ss.lo"};Alfresco.thirdparty.dateFormat.i18n={dayNames:Alfresco.thirdparty.dateFormat.DAY_NAMES,monthNames:Alfresco.thirdparty.dateFormat.MONTH_NAMES};Alfresco.thirdparty.fromISO8601=function(){var a=function(){var b=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;return function(f){var d=b.exec(f);var c=null;if(d){d.shift();if(d[1]){d[1]--}if(d[6]){d[6]*=1000}c=new Date(d[0]||1970,d[1]||0,d[2]||1,d[3]||0,d[4]||0,d[5]||0,d[6]||0);var g=0;var e=d[7]&&d[7].charAt(0);if(e!="Z"){g=((d[8]||0)*60)+(Number(d[9])||0);if(e!="-"){g*=-1}}if(e){g-=c.getTimezoneOffset()}if(g){c.setTime(c.getTime()+g*60000)}}return c}}();return a.apply(arguments.callee,arguments)};Alfresco.thirdparty.toISO8601=function(){var a=function(){var b=function(c){return(c<10)?"0"+c:c};return function(h,n){n=n||{};var g=[];var l=n.zulu?"getUTC":"get";var e="";if(n.selector!="time"){var k=h[l+"FullYear"]();e=["0000".substr((k+"").length)+k,b(h[l+"Month"]()+1),b(h[l+"Date"]())].join("-")}g.push(e);if(n.selector!="date"){var d=[b(h[l+"Hours"]()),b(h[l+"Minutes"]()),b(h[l+"Seconds"]())].join(":");var c=h[l+"Milliseconds"]();if(n.milliseconds===undefined||n.milliseconds){d+="."+(c<100?"0":"")+b(c)}if(n.zulu){d+="Z"}else{if(n.selector!="time"){var m=h.getTimezoneOffset();var f=Math.abs(m);d+=(m>0?"-":"+")+b(Math.floor(f/60))+":"+b(f%60)}}g.push(d)}return g.join("T")}}();return a.apply(arguments.callee,arguments)};Alfresco.service.BaseService=function BaseService_constructor(){return this};Alfresco.service.BaseService.prototype={_jsonCall:function BaseService__jsonCall(d,c,a,b){b=b||{};Alfresco.util.Ajax.jsonRequest({method:d,url:c,dataObj:a,successCallback:b.successCallback,successMessage:b.successMessage,failureCallback:b.failureCallback,failureMessage:b.failureMessage,noReloadOnAuthFailure:b.noReloadOnAuthFailure||false})}};(function(){Alfresco.service.Preferences=function f(){Alfresco.service.Preferences.superclass.constructor.call(this);return this};YAHOO.extend(Alfresco.service.Preferences,Alfresco.service.BaseService,{_url:function c(){return Alfresco.constants.PROXY_URI+"api/people/"+encodeURIComponent(Alfresco.constants.USERNAME)+"/preferences"},request:function d(h,g){this._jsonCall(Alfresco.util.Ajax.GET,this._url()+(h?"?pf="+h:""),null,g)},set:function b(h,l,g){var k=Alfresco.util.dotNotationToObject(h,l);this._jsonCall(Alfresco.util.Ajax.POST,this._url(),k,g)},add:function e(k,o,h){var p=k,g=o;var m=h?h:{};var l=m.successCallback;m.successCallback={fn:function(r,t){m.successCallback=l;var q=Alfresco.util.dotNotationToObject(p,null);q=YAHOO.lang.merge(q,r.json);var n=Alfresco.util.findValueByDotNotation(q,p);if(typeof n=="string"||n===null){var s=n?n.split(","):[];s.push(g);this.set(k,s.join(","),m)}},scope:this};this.request(k,m)},remove:function a(k,o,h){var p=k,g=o;var m=h?h:{};var l=m.successCallback;m.successCallback={fn:function(r,t){m.successCallback=l;var q=Alfresco.util.dotNotationToObject(p,null);q=YAHOO.lang.merge(q,r.json);var n=Alfresco.util.findValueByDotNotation(q,p);if(typeof n=="string"){var s=n?n.split(","):[];s=Alfresco.util.arrayRemove(s,g);this.set(k,s.join(","),m)}},scope:this};this.request(k,m)}})})();(function(){Alfresco.service.Ratings=function d(f){if(typeof f==="undefined"||f===null){throw new Error("Mandatory ratingScheme parameter is missing.")}Alfresco.service.Ratings.superclass.constructor.call(this);this._ratingScheme=f;return this};YAHOO.lang.augmentObject(Alfresco.service.Ratings,{LIKES:"likesRatingScheme",FIVE_STAR:"fiveStarRatingScheme"});YAHOO.extend(Alfresco.service.Ratings,Alfresco.service.BaseService,{_ratingScheme:null,_url:function b(f){return Alfresco.constants.PROXY_URI+"api/node/"+f.uri+"/ratings"},request:function c(g,f){this._jsonCall(Alfresco.util.Ajax.GET,this._url(g),null,f)},set:function e(h,g,f){this._jsonCall(Alfresco.util.Ajax.POST,this._url(h),{rating:g,ratingScheme:this._ratingScheme},f)},remove:function a(g,f){this._jsonCall(Alfresco.util.Ajax.DELETE,this._url(g)+"/"+encodeURIComponent(this._ratingScheme),null,f)}})})();Alfresco.util.RichEditorManager=(function(){var a=[];return({addEditor:function(c,b){a[c]=b},getEditor:function(b){if(a[b]){return a[b]}return null}})})();Alfresco.util.RichEditor=function(g,a,c){var k=Alfresco.util.RichEditorManager.getEditor(g);if(k){var h=new k();YAHOO.lang.augmentObject(h,{unsubscribe:function(){},subscribe:function(n,m,l){var o=h.getEditor();if(o.subscribe){o.subscribe(n,m,l,true)}else{if(o[n]){o[n].add(function(){m.apply(l,arguments)})}}YAHOO.Bubbling.on(n,m,l)},on:function(n,m,l){YAHOO.Bubbling.on(n,m,l)}});if(a&&c){if(c.language){var e=Alfresco.util.message("tinymce_languages").split(","),b="en";for(var f=0,d=e.length;f<d;f++){if(e[f]==c.language){b=c.language;break}}c.language=b}h.init(a,c)}return h}return null};Alfresco.util.RENDERLOOPSIZE=25;(function(){Alfresco.component.Base=function n(q,s,r){this.name=(typeof q=="undefined"||q===null)?"Alfresco.component.Base":q;this.id=(typeof s=="undefined"||s===null)?Alfresco.util.generateDomId():s;this.options=Alfresco.util.deepCopy(this.options);this.widgets={};this.modules={};this.services={};Alfresco.util.ComponentManager.register(this);if(YAHOO.lang.isArray(r)){Alfresco.util.YUILoaderHelper.require(r,this.onComponentsLoaded,this)}else{this.onComponentsLoaded()}return this};Alfresco.component.Base.prototype={options:{},widgets:null,modules:null,services:null,setOptions:function k(q){this.options=YAHOO.lang.merge(this.options,q);return this},setMessages:function g(q){Alfresco.util.addMessages(q,this.name);return this},onComponentsLoaded:function l(){if(this.id!=="null"){YUIEvent.onContentReady(this.id,this.onReadyWrapper,this,true)}},destroy:function o(){var r,q;for(r in this.widgets){if(this.widgets.hasOwnProperty(r)){try{q=this.widgets[r];if(typeof q.destroy=="function"){q.destroy()}}catch(s){}delete this.widgets[r]}}for(r in this.modules){if(this.modules.hasOwnProperty(r)){delete this.modules[r]}}for(r in this.services){if(this.services.hasOwnProperty(r)){delete this.services[r]}}},onReadyWrapper:function m(){if(this.onReady&&this.onReady.call){this.onReady.call(this)}this.createYUIButtons();this.attachLinkClickListeners()},createYUIButtons:function a(){var u=YUISelector.query("button.alfresco-button",this.id),t,w,r,v;for(var s=0,q=u.length;s<q;s++){t=u[s];r=t.getAttribute("name");if(r){w=Alfresco.util.createYUIButton(this,null,function(A,x){var y=A,z=x;return function(){this.invokeAction(y,z,this.widgets[y])}}(r,t.getAttribute("value")),{},u[s]);YAHOO.util.Dom.addClass(w.get("element"),r.substring(1));this.widgets[r.substring(1)]=w}}},attachLinkClickListeners:function b(){var r=function q(w,v){var u=v[1].anchor,t=u.getAttribute("name"),s=u.getAttribute("rel");if(this.invokeAction(t,s,u)){YUIEvent.preventDefault(v[1])}return true};YAHOO.Bubbling.addDefaultAction(this.id,this.bind(r),true)},invokeAction:function d(t,s,q){var u=t.match(/^\.[\w]+$/)?t.substring(1):null,r=t.match(/^\@[\w]+$/)?t.substring(1):null;if(YAHOO.lang.isFunction(this[u])){this[u].call(this,s,q);return true}else{if(r){this.fire(r,s);return true}}},msg:function h(q){return Alfresco.util.message.call(this,q,this.name,Array.prototype.slice.call(arguments).slice(1))},bind:function p(q){return Alfresco.util.bind(q,this)},fire:function f(q,r){r.eventGroup=this;YAHOO.Bubbling.fire(q,r)},refresh:function e(r){var q=Alfresco.util.combinePaths(Alfresco.constants.URL_SERVICECONTEXT,YAHOO.lang.substitute(r,this.options,function(t,u,s){return typeof u==="boolean"?u.toString():u}));q+=(q.indexOf("?")==-1?"?":"&")+"htmlid="+this.id;Alfresco.util.Ajax.request({url:q,successCallback:{fn:this.onComponentLoaded,obj:this,scope:this},scope:this})},onComponentLoaded:function c(r){var q=Alfresco.util.Ajax.sanitizeMarkup(r.serverResponse.responseText);YAHOO.util.Dom.get(this.id).innerHTML=q[0];Alfresco.util.ComponentManager.unregister(this);window.setTimeout(q[1],0)}}})();(function(){Alfresco.component.BaseFilter=function(f,h,g){Alfresco.component.BaseFilter.superclass.constructor.apply(this,arguments);this.filterName=this.name.substring(this.name.lastIndexOf(".")+1);this.controlsDeactivated=false;this.uniqueEventKey=Alfresco.util.generateDomId(null,"filter");YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);return this};YAHOO.extend(Alfresco.component.BaseFilter,Alfresco.component.Base,{filterName:null,selectedFilter:null,controlsDeactivated:null,uniqueEventKey:null,setFilterIds:function c(f){Alfresco.util.FilterManager.register(this.name,f)},onReady:function b(){var l=this,m=YUISelector.query("h2",this.id);if(YAHOO.lang.isArray(m)){Alfresco.util.createTwister(m[0],this.filterName)}var h=YUISelector.query("li a",this.id);for(var f=0,g=h.length;f<g;f++){YUIDom.addClass(h[f],this.uniqueEventKey)}YAHOO.Bubbling.addDefaultAction(this.uniqueEventKey,function k(s,r){var q=r[1].anchor,n=YAHOO.Bubbling.getOwnerByTagName(q,"span");if((n!==null)&&!l.controlsDeactivated){var p=q.getAttribute("href",2);if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<8){var u=p.length-1;if(u<0||p.lastIndexOf("#")!=u){return false}}else{if(q.getAttribute("href",2).length>1){return false}}var o=n.className,t=q.rel;YAHOO.Bubbling.fire("changeFilter",{filterOwner:l.name,filterId:o,filterData:t});if(typeof l[o]=="function"){l[o].call(l)}r[1].stop=true}return true})},onFilterChanged:function e(h,f){var m=Alfresco.util.cleanBubblingObject(f[1]),n=false;if((m!==null)&&(m.filterId!==null)){m.filterOwner=m.filterOwner||Alfresco.util.FilterManager.getOwner(m.filterId);if(m.filterOwner==this.name){if(this.selectedFilter!==null){YUIDom.removeClass(this.selectedFilter,"selected")}var l=YUISelector.query("."+m.filterId,this.id);if(l.length==1){this.selectedFilter=l[0].parentNode;YUIDom.addClass(this.selectedFilter,"selected");n=true}else{if(l.length>1){if(m.filterData.indexOf("]")!==-1||m.filterData.indexOf(",")!==-1){for(var g=0,k=l.length;g<k;g++){if(l[g].firstChild.rel==m.filterData){this.selectedFilter=l[g].parentNode;YUIDom.addClass(this.selectedFilter,"selected");n=true}}}else{l=YUISelector.query("a[rel='"+m.filterData.replace("'","'")+"']",this.id);if(l.length==1){this.selectedFilter=l[0].parentNode.parentNode;YUIDom.addClass(this.selectedFilter,"selected");n=true}}}}if(!n){this.handleFilterIdNotFound(m)}}else{if(this.selectedFilter!==null){YUIDom.removeClass(this.selectedFilter,"selected")}}}},handleFilterIdNotFound:function a(f){},onDeactivateAllControls:function d(h,f){this.controlsDeactivated=true;var l=YUISelector.query("a."+this.uniqueEventKey,this.id);for(var g=0,k=l.length;g<k;g++){YUIDom.addClass(l[g],"disabled")}}})})();(function(){var e=YAHOO.util.Dom;Alfresco.component.FormManager=function h(n,o){Alfresco.component.FormManager.superclass.constructor.call(this,"Alfresco.component.FormManager",n,o);YAHOO.Bubbling.on("formContentReady",this.onFormContentReady,this);YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);return this};YAHOO.extend(Alfresco.component.FormManager,Alfresco.component.Base,{options:{failureMessageKey:"message.failure",submitButtonMessageKey:"button.save",submitUrl:null,cancelUrl:null,defaultUrl:null},onReady:function l(){},onFormContentReady:function d(p,n){var o=n[1].buttons.submit;o.set("label",this.msg(this.options.submitButtonMessageKey));var q=n[1].buttons.cancel;if(q){q.addListener("click",this.onCancelButtonClick,null,this)}},onBeforeFormRuntimeInit:function g(o,n){n[1].runtime.setAJAXSubmit(true,{successCallback:{fn:this.onFormSubmitSuccess,scope:this},failureCallback:{fn:this.onFormSubmitFailure,scope:this}})},onFormSubmitSuccess:function b(n){this.navigateForward(true)},onFormSubmitFailure:function c(n){Alfresco.util.PopupManager.displayPrompt({title:this.msg(this.options.failureMessageKey),text:(n.json&&n.json.message?n.json.message:this.msg(this.options.failureMessageKey))})},onCancelButtonClick:function f(o,n){this.navigateForward(false)},pageUsesAjaxState:function k(n){return false},getSiteDefaultUrl:function m(){return null},navigateForward:function a(n){if(n&&this.options.submitUrl){document.location.href=this.options.submitUrl}else{if(!n&&this.options.cancelUrl){document.location.href=this.options.cancelUrl}else{if(document.referrer){if(this.pageUsesAjaxState(document.referrer)){history.go(-1)}else{document.location.href=document.referrer}}else{if(history.length>1){history.go(-1)}else{if(this.options.defaultUrl){document.location.href=this.options.defaultUrl}else{document.location.href=this.getSiteDefaultUrl()||Alfresco.constants.URL_CONTEXT}}}}}}})})();(function(){var f=YAHOO.util.Dom,q=YAHOO.util.Event;Alfresco.util.DataTable=function(s){if(!s.dataSource||!YAHOO.lang.isString(s.dataSource.url)||!s.dataTable.container||!YAHOO.lang.isArray(s.dataTable.columnDefinitions)){throw new Error("Mandatory config parameter is missing or of wrong type!")}s.dataSource.pagingResolver=s.dataSource.pagingResolver||this._defaultPagingResolver;s.dataSource.defaultFilter=s.dataSource.defaultFilter||null;s.dataSource.config=s.dataSource.config||{};s.dataSource.config.connXhrMode=s.dataSource.config.connXhrMode||"cancelStaleRequests";s.dataSource.config.responseType=s.dataSource.config.responseType||YAHOO.util.DataSource.TYPE_JSON;s.dataSource.config.responseSchema=s.dataSource.config.responseSchema||{};if(!YAHOO.lang.isString(s.dataSource.config.responseSchema.resultsList)){s.dataSource.config.responseSchema.resultsList="data"}s.dataSource.config.responseSchema.fields=s.dataSource.config.responseSchema.fields||null;s.dataSource.config.responseSchema.metaFields=YAHOO.lang.merge({paginationRecordOffset:"paging.skipCount",paginationRowsPerPage:"paging.maxItems",totalRecords:"paging.totalItems"},s.dataSource.config.responseSchema.metaFields||{});s.dataTable.config=YAHOO.lang.merge({dynamicData:true,initialLoad:false,MSG_EMPTY:Alfresco.util.message("message.datatable.empty"),MSG_ERROR:Alfresco.util.message("message.datatable.error"),MSG_LOADING:Alfresco.util.message("message.datatable.loading"),className:"alfresco-datatable"},s.dataTable.config||{});if(s.paginator){s.paginator.history=YAHOO.lang.isBoolean(s.paginator.history)?s.paginator.history:true;s.paginator.hide=YAHOO.lang.isBoolean(s.paginator.hide)?s.paginator.hide:true;s.paginator.config=YAHOO.lang.merge({rowsPerPage:10,recordOffset:0,template:Alfresco.util.message("pagination.template"),pageReportTemplate:Alfresco.util.message("pagination.template.page-report"),previousPageLinkLabel:Alfresco.util.message("pagination.previousPageLinkLabel"),nextPageLinkLabel:Alfresco.util.message("pagination.nextPageLinkLabel")},s.paginator.config||{});if(!s.paginator.config.containers){throw new Error("Mandatory paginator config parameter is missing!")}}this.config=s;this.formatters={};this.widgets={};this._init();return this};Alfresco.util.DataTable.prototype={config:null,widgets:null,formatters:null,currentFilter:{},currentSkipCount:null,currentMaxItems:null,currentSortKey:null,currentDir:null,getRecord:function g(s){return this.widgets.dataTable.getRecord(s)},getData:function a(s){return this.getRecord(s).getData()},getDataTable:function n(){return this.widgets.dataTable},findDataByParameter:function d(u,t){var s=this.findRecordByParameter(u,t);if(s!==null){return s.getData()}return null},findRecordByParameter:function l(x,w){var u=this.widgets.dataTable.getRecordSet(),v,t,s;for(t=0,s=u.getLength();t<s;t++){record=u.getRecord(t);if(record.getData(x)===w){return record}}return null},reloadDataTable:function m(){this.loadDataTable()},loadDataTable:function c(w){var v=this,x=this.createUrlParameters(),t=(this.config.dataSource.url+x).indexOf("?")>-1?"&":"?",u=x+(w?t+w:"");this.widgets.dataSource.sendRequest(u,{success:function s(A,z,B){v.widgets.dataTable.onDataReturnSetRows(A,z,B);var y=v.currentFilter;if(!y.filterId){y=v.config.dataSource.defaultFilter}if(y&&y.filterId){YAHOO.Bubbling.fire("filterChanged",y)}},failure:this.widgets.dataTable.onDataReturnSetRows,scope:this.widgets.dataTable,argument:{}})},createUrlParameters:function k(){if(this.widgets.paginator){var t=null;if((this.currentSkipCount||this.currentMaxItems||this.currentSortKey||this.currentDir)&&YAHOO.lang.isFunction(this.config.dataSource.pagingResolver)){t=this.config.dataSource.pagingResolver(this.currentSkipCount,this.currentMaxItems,this.currentSortKey,this.currentDir)}}var s=null;if(this.currentFilter&&YAHOO.lang.isFunction(this.config.dataSource.filterResolver)){s=this.config.dataSource.filterResolver(this.currentFilter)}var u=["?","&"];if(this.config.dataSource.url.indexOf("?")>-1){u=["&","&"]}return(t?u.shift()+t:"")+(s?u.shift()+s:"")},_init:function p(){var N=this,x=YAHOO.util.History;this.widgets.dataSource=new YAHOO.util.DataSource(this.config.dataSource.url,this.config.dataSource.config);this.widgets.dataSource.doBeforeParseData=this.config.dataSource.doBeforeParseData||this.widgets.dataSource.doBeforeParseData;if(this.config.paginator){this.widgets.paginator=new YAHOO.widget.Paginator(this.config.paginator.config);this.config.dataTable.config.paginator=this.widgets.paginator}var K=this.config.dataTable.columnDefinitions;for(var J=0,D=K.length;J<D;J++){if(YAHOO.lang.isFunction(K[J].formatter)){this.formatters[J]=K[J].formatter;K[J].formatter=function(O,P,Q,R){if(Q.width){YAHOO.util.Dom.setStyle(O,"width",Q.width+(YAHOO.lang.isNumber(Q.width)?"px":""));YAHOO.util.Dom.setStyle(O.parentNode,"width",Q.width+(YAHOO.lang.isNumber(Q.width)?"px":""))}N.formatters[Q.getIndex()].call(this,O,P,Q,R)}}}var t=(f.get(this.config.dataTable.container).getAttribute("class")||"").split(/\s/);this.widgets.dataTable=new YAHOO.widget.DataTable(this.config.dataTable.container,K,this.widgets.dataSource,this.config.dataTable.config);this.widgets.dataTable.showTableMessage(this.config.dataTable.config.MSG_LOADING,YAHOO.widget.DataTable.CLASS_LOADING);for(J=0,D=t.length;J<D;J++){f.addClass(this.widgets.dataTable.get("element"),t[J])}this.widgets.dataTable._deleteTrEl=function A(R){var P=this,Q=this.getTrEl(R);var O=new YAHOO.util.ColorAnim(Q,{opacity:{to:0}},0.25);O.onComplete.subscribe(function(){YAHOO.widget.DataTable.prototype._deleteTrEl.call(P,R)});O.animate()};this.widgets.dataTable.subscribe("rowMouseoverEvent",this.widgets.dataTable.onEventHighlightRow);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.widgets.dataTable.onEventUnhighlightRow);var w=function z(){if(N.currentFilter.filterId){N.loadDataTable()}else{if(N.config.dataSource.defaultFilter){N.currentFilter=N.config.dataSource.defaultFilter;N.loadDataTable()}else{if(YAHOO.lang.isString(N.config.dataSource.initialParameters)){N.loadDataTable(N.config.dataSource.initialParameters)}else{N.loadDataTable()}}}};var G=function E(P){if(N.config.paginator&&N.config.paginator.history){var O=N.getPagingState(P.recordOffset,P.rowsPerPage);if(O){x.multiNavigate({paging:O})}}else{N.setPagingState(N.getPagingState(P.recordOffset,P.rowsPerPage));N.loadDataTable()}};if(this.widgets.paginator){this.widgets.paginator.unsubscribe("changeRequest",this.widgets.dataTable.onPaginatorChangeRequest);this.widgets.paginator.subscribe("changeRequest",G,this.widgets.dataTable,true)}this.widgets.dataTable.doBeforeLoadData=function(P,O,R){if(N.config.paginator){var Q=O.meta||{};R.totalRecords=YAHOO.lang.isNumber(Q.totalRecords)?Q.totalRecords:R.totalRecords;R.pagination={rowsPerPage:YAHOO.lang.isNumber(Q.paginationRowsPerPage)?Q.paginationRowsPerPage:N.config.paginator.config.rowsPerPage,recordOffset:YAHOO.lang.isNumber(Q.paginationRecordOffset)?Q.paginationRecordOffset:N.config.paginator.config.recordOffset};if(N.config.paginator.hide){if(R.totalRecords<=R.pagination.rowsPerPage){f.addClass(N.widgets.paginator.get("containers"),"hidden")}else{f.removeClass(N.widgets.paginator.get("containers"),"hidden")}}}return true};var v=function F(O){N.setPagingState(O);if(x.getBookmarkedState("filter")==null||x.getBookmarkedState("filter")==x.getCurrentState("filter")){N.loadDataTable()}};var M=function B(O){N.setFilterState(O);N.loadDataTable()};YAHOO.Bubbling.on("changeFilter",function u(P,O){if(N.config.paginator&&N.config.paginator.history){var Q=O[1]?N.getFilterState(O[1]):null;if(Q){x.multiNavigate({paging:"|",filter:Q})}}else{N.setFilterState(N.getFilterState(O[1]));N.loadDataTable()}},this);if(this.config.paginator){var s=this.config.paginator.config;if(this.config.paginator.history){x.register("paging",x.getBookmarkedState("paging")||this.getPagingState(s.recordOffset,s.rowsPerPage),v);x.register("filter",x.getBookmarkedState("filter")||this.getFilterState(this.config.dataSource.defaultFilter),M);var H=function y(){N.setPagingState(x.getCurrentState("paging"));N.setFilterState(x.getCurrentState("filter"));if(N.widgets.paginator){N.currentSkipCount=N.currentSkipCount||N.config.paginator.config.recordOffset;N.currentMaxItems=N.currentMaxItems||N.config.paginator.config.rowsPerPage}w()};x.onReady(H,{},this);try{var I="";if(YAHOO.env.ua.ie>0&&!f.get("yui-history-iframe")){I+='<iframe id="yui-history-iframe" src="'+Alfresco.constants.URL_RESCONTEXT+'yui/history/assets/blank.html" style="display: none;"></iframe>'}if(!f.get("yui-history-field")){I+='<input id="yui-history-field" type="hidden" />'}if(I.length>0){var C=document.createElement("div");C.innerHTML=I;document.body.appendChild(C)}x.initialize("yui-history-field","yui-history-iframe")}catch(L){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",L);H()}}else{this.currentSkipCount=this.currentSkipCount||s.recordOffset;this.currentMaxItems=this.currentMaxItems||s.rowsPerPage;w()}}else{w()}},_defaultPagingResolver:function h(s,t){return"skipCount="+s+"&maxItems="+t},getPagingState:function o(s,t){return YAHOO.lang.isNumber(s)?(s+(YAHOO.lang.isNumber(t)?"|"+t:"")):""},setPagingState:function e(t){var s=(t&&t.indexOf("|")>0)?t.split("|"):[];this.currentSkipCount=s.length>0?parseInt(s[0]):this.config.paginator.config.recordOffset;this.currentMaxItems=s.length>1?parseInt(s[1]):this.config.paginator.config.rowsPerPage},getFilterState:function b(s){if(s){return s.filterId?(s.filterId+(s.filterData?("|"+s.filterData):"")):""}return""},setFilterState:function r(u){var t={};if(u.indexOf("|")>0){var s=u.split("|");t.filterId=s[0];t.filterData=s.slice(1).join("|")}else{t.filterId=u.length>0?u:undefined}this.currentFilter=t||{}}}})();Alfresco.util.toggleClass=function(a,b){if(YUIDom.hasClass(a,b)){YUIDom.removeClass(a,b)}else{YUIDom.addClass(a,b)}};